<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Enhanced Form View (existing) -->
    <record id="view_move_form_inherit_custom_fields" model="ir.ui.view">
        <field name="name">account.move.form.inherit.custom.fields</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <!-- Add Deal Information Tab/Page -->
            <xpath expr="//page[last()]" position="after">
                <page string="Deal Information" name="deal_info_page" invisible="move_type not in ['out_invoice', 'out_refund']">
                <group name="deal_main_info">
                    <group string="Deal Identification" name="deal_identification">
                        <field name="deal_id"/>
                        <field name="booking_date"/>
                    </group>
                    <group string="Buyer Information" name="buyer_info">
                        <field name="buyer_id"/>
                    </group>
                </group>
                <group name="deal_project_info">
                    <group string="Project Details" name="project_details">
                        <field name="project_id"/>
                        <field name="unit_id"/>
                    </group>
                    <group string="Financial Information" name="financial_info">
                        <field name="sale_value"/>
                        <field name="developer_commission" widget="percentage"/>
                    </group>
                </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Enhanced List View -->
    <record id="view_move_tree_inherit_custom_fields" model="ir.ui.view">
        <field name="name">account.move.tree.inherit.custom.fields</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_tree"/>
        <field name="arch" type="xml">
            <!-- Add columns at the end -->
            <xpath expr="//tree" position="inside">
                <field name="deal_id" optional="show" invisible="move_type not in ['out_invoice', 'out_refund']"/>
                <field name="buyer_id" optional="show" invisible="move_type not in ['out_invoice', 'out_refund']"/>
                <field name="project_id" optional="hide" invisible="move_type not in ['out_invoice', 'out_refund']"/>
                <field name="unit_id" optional="hide" invisible="move_type not in ['out_invoice', 'out_refund']"/>
                <field name="booking_date" optional="hide" invisible="move_type not in ['out_invoice', 'out_refund']"/>
                <field name="sale_value" optional="hide" invisible="move_type not in ['out_invoice', 'out_refund']"/>
                <field name="developer_commission" widget="percentage" optional="hide" invisible="move_type not in ['out_invoice', 'out_refund']"/>
                <field name="move_type" invisible="1"/>
            </xpath>
        </field>
    </record>

    <!-- Enhanced Search View -->
    <record id="view_account_move_filter_inherit_custom_fields" model="ir.ui.view">
        <field name="name">account.move.search.inherit.custom.fields</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_move_filter"/>
        <field name="arch" type="xml">
            <!-- Add search fields at the end -->
            <xpath expr="//search" position="inside">
                <field name="deal_id" string="Deal ID"/>
                <field name="buyer_id" string="Buyer"/>
                <field name="project_id" string="Project"/>
                <field name="unit_id" string="Unit"/>
            </xpath>
            
            <!-- Add filters at the end -->
            <xpath expr="//search" position="inside">
                <separator/>
                <filter string="With Deal ID" name="has_deal_id" domain="[('deal_id', '!=', False)]"/>
                <filter string="With Buyer" name="has_buyer" domain="[('buyer_id', '!=', False)]"/>
                <filter string="With Project" name="has_project" domain="[('project_id', '!=', False)]"/>
                <filter string="Customer Invoices with Deal Info" name="customer_invoices_with_deal" 
                        domain="[('move_type', 'in', ['out_invoice', 'out_refund']), ('deal_id', '!=', False)]"/>
                <filter string="This Month Bookings" name="this_month_bookings" 
                        domain="[('booking_date', '>=', (context_today() - relativedelta(day=1)).strftime('%Y-%m-%d')),
                                ('booking_date', '&lt;', (context_today() + relativedelta(months=1, day=1)).strftime('%Y-%m-%d'))]"/>
            </xpath>
            
            <!-- Add group by options -->
            <xpath expr="//search" position="inside">
                <group expand="0" string="Deal Group By">
                    <filter string="Buyer" name="group_by_buyer" domain="[]" context="{'group_by': 'buyer_id'}"/>
                    <filter string="Project" name="group_by_project" domain="[]" context="{'group_by': 'project_id'}"/>
                    <filter string="Booking Date" name="group_by_booking_date" domain="[]" context="{'group_by': 'booking_date'}"/>
                    <filter string="Deal ID" name="group_by_deal_id" domain="[]" context="{'group_by': 'deal_id'}"/>
                </group>
            </xpath>
        </field>
    </record>
</odoo>