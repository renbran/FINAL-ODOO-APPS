&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;templates&gt;
    
    &lt;!-- Balance Sheet Report Template --&gt;
    &lt;t t-name="enterprise_dynamic_reports.BalanceSheetTemplate" owl="1"&gt;
        &lt;div class="o_enterprise_reports o_enterprise_balance_sheet"&gt;
            &lt;div class="o_enterprise_reports_container"&gt;
                
                &lt;!-- Report Header --&gt;
                &lt;div class="o_enterprise_reports_header"&gt;
                    &lt;div class="o_enterprise_title"&gt;
                        &lt;div class="o_enterprise_icon"&gt;
                            &lt;i class="fa fa-balance-scale"/&gt;
                        &lt;/div&gt;
                        Balance Sheet Report
                    &lt;/div&gt;
                    &lt;div class="o_enterprise_subtitle"&gt;
                        Financial position as of &lt;span t-esc="state.reportOptions.date_to"/&gt;
                    &lt;/div&gt;
                    
                    &lt;div class="o_enterprise_meta"&gt;
                        &lt;div class="o_enterprise_meta_item"&gt;
                            &lt;i class="o_enterprise_meta_icon fa fa-building"/&gt;
                            &lt;span t-esc="state.reportOptions.company_name"/&gt;
                        &lt;/div&gt;
                        &lt;div class="o_enterprise_meta_item"&gt;
                            &lt;i class="o_enterprise_meta_icon fa fa-calendar"/&gt;
                            &lt;span t-esc="state.reportOptions.date_from"/&gt; to &lt;span t-esc="state.reportOptions.date_to"/&gt;
                        &lt;/div&gt;
                        &lt;div class="o_enterprise_meta_item"&gt;
                            &lt;i class="o_enterprise_meta_icon fa fa-money-bill"/&gt;
                            &lt;span t-esc="state.reportOptions.currency_symbol"/&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;!-- Quick Filters --&gt;
                &lt;div class="o_enterprise_quick_filters"&gt;
                    &lt;a t-foreach="Object.entries(state.filters.date_filters || {})" 
                       t-as="filter" 
                       t-key="filter[0]"
                       class="o_enterprise_quick_filter"
                       t-att-class="state.selectedFilter === filter[0] ? 'active' : ''"
                       t-on-click="() =&gt; this.onDateFilterChange(filter[0])"
                       t-esc="filter[1].label"/&gt;
                    
                    &lt;a class="o_enterprise_quick_filter" 
                       t-on-click="onToggleFilters"&gt;
                        &lt;i class="fa fa-filter"/&gt; More Filters
                    &lt;/a&gt;
                &lt;/div&gt;
                
                &lt;!-- Advanced Filter Panel --&gt;
                &lt;div t-if="state.showFilters" class="o_enterprise_filter_panel"&gt;
                    &lt;div class="o_enterprise_filter_header"&gt;
                        &lt;h3&gt;Report Filters&lt;/h3&gt;
                        &lt;button class="o_enterprise_filter_toggle" t-on-click="onToggleFilters"&gt;
                            &lt;i class="fa fa-times"/&gt;
                        &lt;/button&gt;
                    &lt;/div&gt;
                    
                    &lt;div class="o_enterprise_filter_content"&gt;
                        &lt;div class="o_enterprise_filter_group"&gt;
                            &lt;label class="o_enterprise_filter_label"&gt;Start Date&lt;/label&gt;
                            &lt;input class="o_enterprise_filter_input" 
                                   type="date" 
                                   t-model="state.reportOptions.date_from"
                                   t-on-change="onCustomDateChange"/&gt;
                        &lt;/div&gt;
                        
                        &lt;div class="o_enterprise_filter_group"&gt;
                            &lt;label class="o_enterprise_filter_label"&gt;End Date&lt;/label&gt;
                            &lt;input class="o_enterprise_filter_input" 
                                   type="date" 
                                   t-model="state.reportOptions.date_to"
                                   t-on-change="onCustomDateChange"/&gt;
                        &lt;/div&gt;
                        
                        &lt;div class="o_enterprise_filter_group"&gt;
                            &lt;label class="o_enterprise_filter_label"&gt;Comparison Mode&lt;/label&gt;
                            &lt;select class="o_enterprise_filter_select" 
                                    t-model="state.reportOptions.comparison_mode"
                                    t-on-change="(ev) =&gt; this.onComparisonModeChange(ev.target.value)"&gt;
                                &lt;option value="none"&gt;No Comparison&lt;/option&gt;
                                &lt;option value="previous_period"&gt;Previous Period&lt;/option&gt;
                                &lt;option value="previous_year"&gt;Previous Year&lt;/option&gt;
                                &lt;option value="custom"&gt;Custom Period&lt;/option&gt;
                            &lt;/select&gt;
                        &lt;/div&gt;
                        
                        &lt;div class="o_enterprise_filter_group"&gt;
                            &lt;label class="o_enterprise_filter_label"&gt;Detail Level&lt;/label&gt;
                            &lt;select class="o_enterprise_filter_select" 
                                    t-model="state.reportOptions.drill_down_level"&gt;
                                &lt;option value="summary"&gt;Summary Only&lt;/option&gt;
                                &lt;option value="account_type"&gt;By Account Type&lt;/option&gt;
                                &lt;option value="account_group"&gt;By Account Group&lt;/option&gt;
                                &lt;option value="account_detail"&gt;Account Detail&lt;/option&gt;
                            &lt;/select&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;div class="o_enterprise_filter_actions"&gt;
                        &lt;button class="o_enterprise_btn o_enterprise_btn_secondary" 
                                t-on-click="onResetFilters"&gt;
                            Reset
                        &lt;/button&gt;
                        &lt;button class="o_enterprise_btn o_enterprise_btn_primary" 
                                t-on-click="onRefreshReport"&gt;
                            Apply Filters
                        &lt;/button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;!-- Loading State --&gt;
                &lt;div t-if="state.isLoading" class="o_enterprise_loading"&gt;
                    &lt;div class="o_enterprise_loading_spinner"/&gt;
                    &lt;div class="o_enterprise_loading_text"&gt;Generating balance sheet...&lt;/div&gt;
                &lt;/div&gt;
                
                &lt;!-- Error State --&gt;
                &lt;div t-if="state.error" class="o_enterprise_error"&gt;
                    &lt;div class="o_enterprise_error_icon"&gt;
                        &lt;i class="fa fa-exclamation-triangle"/&gt;
                    &lt;/div&gt;
                    &lt;h3 class="o_enterprise_error_title"&gt;Error Generating Report&lt;/h3&gt;
                    &lt;p class="o_enterprise_error_message" t-esc="state.error"/&gt;
                    &lt;button class="o_enterprise_btn o_enterprise_btn_primary" 
                            t-on-click="onRefreshReport"&gt;
                        Try Again
                    &lt;/button&gt;
                &lt;/div&gt;
                
                &lt;!-- Report Content --&gt;
                &lt;div t-if="!state.isLoading and !state.error and state.reportData" class="o_enterprise_report_content"&gt;
                    
                    &lt;!-- Report Toolbar --&gt;
                    &lt;div class="o_enterprise_report_toolbar"&gt;
                        &lt;h2 class="o_enterprise_report_title"&gt;Balance Sheet&lt;/h2&gt;
                        
                        &lt;div class="o_enterprise_report_actions"&gt;
                            &lt;button class="o_enterprise_action_btn" 
                                    t-on-click="onPrint"
                                    title="Print Report"&gt;
                                &lt;i class="fa fa-print"/&gt;
                                Print
                            &lt;/button&gt;
                            
                            &lt;button class="o_enterprise_action_btn" 
                                    t-on-click="onExportPDF"
                                    t-att-disabled="state.exporting"
                                    title="Export as PDF"&gt;
                                &lt;i t-if="!state.exporting" class="fa fa-file-pdf"/&gt;
                                &lt;i t-else="" class="fa fa-spinner fa-spin"/&gt;
                                PDF
                            &lt;/button&gt;
                            
                            &lt;button class="o_enterprise_action_btn" 
                                    t-on-click="onExportExcel"
                                    t-att-disabled="state.exporting"
                                    title="Export as Excel"&gt;
                                &lt;i t-if="!state.exporting" class="fa fa-file-excel"/&gt;
                                &lt;i t-else="" class="fa fa-spinner fa-spin"/&gt;
                                Excel
                            &lt;/button&gt;
                            
                            &lt;button class="o_enterprise_action_btn o_enterprise_action_primary" 
                                    t-on-click="onRefreshReport"
                                    title="Refresh Report (Ctrl+R)"&gt;
                                &lt;i class="fa fa-refresh"/&gt;
                                Refresh
                            &lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;!-- Report Body --&gt;
                    &lt;div class="o_enterprise_report_body"&gt;
                        
                        &lt;!-- Financial Ratios Summary --&gt;
                        &lt;div t-if="state.reportData.ratios" class="o_enterprise_ratios_panel"&gt;
                            &lt;h3&gt;Key Financial Ratios&lt;/h3&gt;
                            &lt;div class="o_enterprise_ratios_grid"&gt;
                                &lt;div t-foreach="Object.entries(state.reportData.ratios.formatted || {})" 
                                     t-as="ratio" 
                                     t-key="ratio[0]"
                                     class="o_enterprise_ratio_card"&gt;
                                    &lt;div class="o_enterprise_ratio_name" 
                                         t-esc="ratio[0].replace('_', ' ').replace(/\b\w/g, l =&gt; l.toUpperCase())"/&gt;
                                    &lt;div t-att-class="'o_enterprise_ratio_value ' + this.getRatioClass(ratio[0], state.reportData.ratios[ratio[0]])" 
                                         t-esc="ratio[1]"/&gt;
                                    &lt;div class="o_enterprise_ratio_desc" 
                                         t-esc="this.getRatioInterpretation(ratio[0], state.reportData.ratios[ratio[0]]).description"/&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                        
                        &lt;!-- Balance Sheet Table --&gt;
                        &lt;div class="o_enterprise_balance_sheet_table"&gt;
                            
                            &lt;!-- Assets Section --&gt;
                            &lt;div class="o_enterprise_bs_section"&gt;
                                &lt;div class="o_enterprise_bs_section_header" 
                                     t-on-click="() =&gt; this.onToggleSection('assets')"&gt;
                                    &lt;h3&gt;
                                        &lt;i t-att-class="'fa ' + (this.isSectionExpanded('assets') ? 'fa-chevron-down' : 'fa-chevron-right')"/&gt;
                                        &lt;i t-att-class="'fa ' + this.getSectionIcon('assets')"/&gt;
                                        ASSETS
                                    &lt;/h3&gt;
                                    &lt;div class="o_enterprise_bs_section_total"&gt;
                                        &lt;strong t-esc="this.formatCurrency(state.reportData.totals.current.total_assets)"/&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                                
                                &lt;div t-if="this.isSectionExpanded('assets')" class="o_enterprise_bs_section_content"&gt;
                                    &lt;div t-foreach="Object.entries(state.reportData.current_period.assets || {})" 
                                         t-as="assetCategory" 
                                         t-key="assetCategory[0]"
                                         class="o_enterprise_bs_category"&gt;
                                        
                                        &lt;div class="o_enterprise_bs_category_header"&gt;
                                            &lt;span class="o_enterprise_bs_category_name" t-esc="assetCategory[1].name"/&gt;
                                            &lt;span class="o_enterprise_bs_category_amount" 
                                                  t-esc="assetCategory[1].formatted_balance"/&gt;
                                        &lt;/div&gt;
                                        
                                        &lt;!-- Subcategories --&gt;
                                        &lt;div t-if="Object.keys(assetCategory[1].subcategories || {}).length &gt; 0" 
                                             class="o_enterprise_bs_subcategories"&gt;
                                            &lt;div t-foreach="Object.entries(assetCategory[1].subcategories)" 
                                                 t-as="subCategory" 
                                                 t-key="subCategory[0]"
                                                 class="o_enterprise_bs_subcategory"&gt;
                                                
                                                &lt;div class="o_enterprise_bs_subcategory_header"&gt;
                                                    &lt;span class="o_enterprise_bs_subcategory_name" t-esc="subCategory[1].name"/&gt;
                                                    &lt;span class="o_enterprise_bs_subcategory_amount" 
                                                          t-esc="subCategory[1].formatted_balance"/&gt;
                                                &lt;/div&gt;
                                                
                                                &lt;!-- Accounts --&gt;
                                                &lt;div t-if="state.reportOptions.drill_down_level === 'account_detail'" 
                                                     class="o_enterprise_bs_accounts"&gt;
                                                    &lt;div t-foreach="subCategory[1].accounts || []" 
                                                         t-as="account" 
                                                         t-key="account.id"
                                                         class="o_enterprise_bs_account"
                                                         t-on-click="() =&gt; this.onDrillDown(account.id, account.code)"&gt;
                                                        &lt;span class="o_enterprise_bs_account_code" t-esc="account.code"/&gt;
                                                        &lt;span class="o_enterprise_bs_account_name" t-esc="account.name"/&gt;
                                                        &lt;span class="o_enterprise_bs_account_amount" 
                                                              t-esc="account.formatted_balance"/&gt;
                                                    &lt;/div&gt;
                                                &lt;/div&gt;
                                                
                                            &lt;/div&gt;
                                        &lt;/div&gt;
                                        
                                        &lt;!-- Direct Accounts (no subcategories) --&gt;
                                        &lt;div t-if="state.reportOptions.drill_down_level === 'account_detail' and assetCategory[1].accounts?.length &gt; 0" 
                                             class="o_enterprise_bs_accounts"&gt;
                                            &lt;div t-foreach="assetCategory[1].accounts" 
                                                 t-as="account" 
                                                 t-key="account.id"
                                                 class="o_enterprise_bs_account"
                                                 t-on-click="() =&gt; this.onDrillDown(account.id, account.code)"&gt;
                                                &lt;span class="o_enterprise_bs_account_code" t-esc="account.code"/&gt;
                                                &lt;span class="o_enterprise_bs_account_name" t-esc="account.name"/&gt;
                                                &lt;span class="o_enterprise_bs_account_amount" 
                                                      t-esc="account.formatted_balance"/&gt;
                                            &lt;/div&gt;
                                        &lt;/div&gt;
                                        
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            
                            &lt;!-- Liabilities Section --&gt;
                            &lt;div class="o_enterprise_bs_section"&gt;
                                &lt;div class="o_enterprise_bs_section_header" 
                                     t-on-click="() =&gt; this.onToggleSection('liabilities')"&gt;
                                    &lt;h3&gt;
                                        &lt;i t-att-class="'fa ' + (this.isSectionExpanded('liabilities') ? 'fa-chevron-down' : 'fa-chevron-right')"/&gt;
                                        &lt;i t-att-class="'fa ' + this.getSectionIcon('liabilities')"/&gt;
                                        LIABILITIES
                                    &lt;/h3&gt;
                                    &lt;div class="o_enterprise_bs_section_total"&gt;
                                        &lt;strong t-esc="this.formatCurrency(state.reportData.totals.current.total_liabilities)"/&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                                
                                &lt;div t-if="this.isSectionExpanded('liabilities')" class="o_enterprise_bs_section_content"&gt;
                                    &lt;!-- Similar structure as assets --&gt;
                                    &lt;div t-foreach="Object.entries(state.reportData.current_period.liabilities || {})" 
                                         t-as="liabilityCategory" 
                                         t-key="liabilityCategory[0]"
                                         class="o_enterprise_bs_category"&gt;
                                        
                                        &lt;div class="o_enterprise_bs_category_header"&gt;
                                            &lt;span class="o_enterprise_bs_category_name" t-esc="liabilityCategory[1].name"/&gt;
                                            &lt;span class="o_enterprise_bs_category_amount" 
                                                  t-esc="liabilityCategory[1].formatted_balance"/&gt;
                                        &lt;/div&gt;
                                        
                                        &lt;!-- Implement similar subcategory and account structure --&gt;
                                        
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            
                            &lt;!-- Equity Section --&gt;
                            &lt;div class="o_enterprise_bs_section"&gt;
                                &lt;div class="o_enterprise_bs_section_header" 
                                     t-on-click="() =&gt; this.onToggleSection('equity')"&gt;
                                    &lt;h3&gt;
                                        &lt;i t-att-class="'fa ' + (this.isSectionExpanded('equity') ? 'fa-chevron-down' : 'fa-chevron-right')"/&gt;
                                        &lt;i t-att-class="'fa ' + this.getSectionIcon('equity')"/&gt;
                                        EQUITY
                                    &lt;/h3&gt;
                                    &lt;div class="o_enterprise_bs_section_total"&gt;
                                        &lt;strong t-esc="this.formatCurrency(state.reportData.totals.current.total_equity)"/&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                                
                                &lt;div t-if="this.isSectionExpanded('equity')" class="o_enterprise_bs_section_content"&gt;
                                    &lt;!-- Similar structure as assets --&gt;
                                    &lt;div t-foreach="Object.entries(state.reportData.current_period.equity || {})" 
                                         t-as="equityCategory" 
                                         t-key="equityCategory[0]"
                                         class="o_enterprise_bs_category"&gt;
                                        
                                        &lt;div class="o_enterprise_bs_category_header"&gt;
                                            &lt;span class="o_enterprise_bs_category_name" t-esc="equityCategory[1].name"/&gt;
                                            &lt;span class="o_enterprise_bs_category_amount" 
                                                  t-esc="equityCategory[1].formatted_balance"/&gt;
                                        &lt;/div&gt;
                                        
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            
                            &lt;!-- Total Balance Check --&gt;
                            &lt;div class="o_enterprise_bs_balance_check"&gt;
                                &lt;div class="o_enterprise_bs_check_item"&gt;
                                    &lt;span&gt;Total Assets&lt;/span&gt;
                                    &lt;span t-esc="this.formatCurrency(state.reportData.totals.current.total_assets)"/&gt;
                                &lt;/div&gt;
                                &lt;div class="o_enterprise_bs_check_item"&gt;
                                    &lt;span&gt;Total Liabilities + Equity&lt;/span&gt;
                                    &lt;span t-esc="this.formatCurrency(state.reportData.totals.current.total_liabilities_equity)"/&gt;
                                &lt;/div&gt;
                                &lt;div t-att-class="'o_enterprise_bs_check_difference ' + (Math.abs(state.reportData.totals.current.balance_check) &lt; 0.01 ? 'balanced' : 'unbalanced')"&gt;
                                    &lt;span&gt;Difference&lt;/span&gt;
                                    &lt;span t-esc="this.formatCurrency(state.reportData.totals.current.balance_check)"/&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            
                        &lt;/div&gt;
                        
                    &lt;/div&gt;
                    
                &lt;/div&gt;
                
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/t&gt;
    
&lt;/templates&gt;
