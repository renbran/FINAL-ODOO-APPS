<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Commission Integration Views for OSUS Enhanced Workflow -->
        
        <!-- Commission Summary View -->
        <record id="view_commission_summary_form" model="ir.ui.view">
            <field name="name">osus.commission.summary.form</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <form string="Commission Summary" class="osus-commission-form">
                    <header>
                        <button name="action_recalculate_commission" type="object" 
                                string="Recalculate Commission" 
                                class="btn-osus-primary"
                                attrs="{'invisible': [('commission_calculated', '=', True)]}"/>
                        <button name="action_approve_commission" type="object" 
                                string="Approve Commission" 
                                class="btn-osus-success"
                                attrs="{'invisible': [('commission_approved', '=', True)]}"/>
                        <field name="commission_status" widget="statusbar"/>
                    </header>
                    
                    <sheet>
                        <div class="osus-commission-header">
                            <div class="osus-branding-card">
                                <div class="osus-logo">
                                    <div class="osus-icon">💰</div>
                                    <div class="osus-title">Commission Management</div>
                                </div>
                                <div class="commission-badges">
                                    <span class="badge badge-osus-primary" t-if="commission_calculated">Calculated</span>
                                    <span class="badge badge-osus-success" t-if="commission_approved">Approved</span>
                                    <span class="badge badge-osus-warning" t-if="commission_external">External</span>
                                </div>
                            </div>
                        </div>
                        
                        <group>
                            <group string="Order Information">
                                <field name="name" readonly="1"/>
                                <field name="partner_id" readonly="1"/>
                                <field name="user_id" readonly="1"/>
                                <field name="amount_total" readonly="1"/>
                                <field name="currency_id" invisible="1"/>
                            </group>
                            
                            <group string="Commission Details">
                                <field name="commission_calculated" widget="boolean_toggle"/>
                                <field name="commission_calculated_date" readonly="1"/>
                                <field name="commission_user_id"/>
                                <field name="commission_approved" widget="boolean_toggle"/>
                                <field name="commission_approved_date" readonly="1"/>
                            </group>
                        </group>
                        
                        <group string="Commission Calculation">
                            <group>
                                <field name="total_commission_amount" widget="monetary" readonly="1" class="osus-commission-amount"/>
                                <field name="commission_percentage" widget="percentage" readonly="1"/>
                                <field name="commission_external" widget="boolean_toggle"/>
                                <field name="external_commission_amount" widget="monetary" 
                                       attrs="{'invisible': [('commission_external', '=', False)]}"/>
                            </group>
                            
                            <group>
                                <field name="internal_commission_amount" widget="monetary" readonly="1"/>
                                <field name="commission_split_percentage" widget="percentage"
                                       attrs="{'invisible': [('commission_external', '=', False)]}"/>
                                <field name="commission_notes" placeholder="Commission calculation notes..."/>
                            </group>
                        </group>
                        
                        <!-- Commission Breakdown Section -->
                        <notebook>
                            <page string="Commission Breakdown" name="commission_breakdown">
                                <div class="osus-commission-breakdown">
                                    <div class="commission-chart">
                                        <h4>Commission Distribution</h4>
                                        <div class="commission-bars">
                                            <div class="commission-bar">
                                                <label>Internal Commission</label>
                                                <div class="bar-container">
                                                    <div class="bar internal" style="width: 60%"></div>
                                                    <span class="amount"><field name="internal_commission_amount" widget="monetary" readonly="1"/></span>
                                                </div>
                                            </div>
                                            <div class="commission-bar" attrs="{'invisible': [('commission_external', '=', False)]}">
                                                <label>External Commission</label>
                                                <div class="bar-container">
                                                    <div class="bar external" style="width: 40%"></div>
                                                    <span class="amount"><field name="external_commission_amount" widget="monetary" readonly="1"/></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </page>
                            
                            <page string="Calculation Details" name="calculation_details">
                                <group>
                                    <field name="commission_calculation_method" readonly="1"/>
                                    <field name="commission_calculation_log" widget="text" readonly="1"/>
                                </group>
                            </page>
                            
                            <page string="Integration Status" name="integration_status">
                                <div class="osus-integration-status">
                                    <h4>Commission_AX Integration</h4>
                                    <div class="integration-info">
                                        <div class="status-item">
                                            <i class="fa fa-check-circle text-success" attrs="{'invisible': [('commission_calculated', '=', False)]}"></i>
                                            <i class="fa fa-clock-o text-warning" attrs="{'invisible': [('commission_calculated', '=', True)]}"></i>
                                            <span>Commission Calculation</span>
                                        </div>
                                        <div class="status-item">
                                            <i class="fa fa-check-circle text-success" attrs="{'invisible': [('commission_approved', '=', False)]}"></i>
                                            <i class="fa fa-clock-o text-warning" attrs="{'invisible': [('commission_approved', '=', True)]}"></i>
                                            <span>Commission Approval</span>
                                        </div>
                                    </div>
                                </div>
                            </page>
                        </notebook>
                    </sheet>
                    
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        
        <!-- Commission List View -->
        <record id="view_commission_summary_tree" model="ir.ui.view">
            <field name="name">osus.commission.summary.tree</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <tree string="Commission Summary" class="osus-commission-tree">
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                    <field name="amount_total" widget="monetary"/>
                    <field name="total_commission_amount" widget="monetary" class="osus-commission-amount"/>
                    <field name="commission_percentage" widget="percentage"/>
                    <field name="commission_calculated" widget="boolean_toggle"/>
                    <field name="commission_approved" widget="boolean_toggle"/>
                    <field name="commission_external" widget="boolean_toggle"/>
                    <field name="commission_calculated_date"/>
                    <field name="currency_id" invisible="1"/>
                </tree>
            </field>
        </record>
        
        <!-- Commission Kanban View -->
        <record id="view_commission_summary_kanban" model="ir.ui.view">
            <field name="name">osus.commission.summary.kanban</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <kanban default_group_by="commission_calculated" class="osus-commission-kanban">
                    <field name="id"/>
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                    <field name="amount_total"/>
                    <field name="total_commission_amount"/>
                    <field name="commission_percentage"/>
                    <field name="commission_calculated"/>
                    <field name="commission_approved"/>
                    <field name="commission_external"/>
                    
                    <templates>
                        <t t-name="kanban-box">
                            <div class="osus-commission-card kanban-card">
                                <div class="osus-card-header">
                                    <div class="card-title">
                                        <strong><field name="name"/></strong>
                                        <div class="commission-badges float-end">
                                            <span class="badge badge-success" t-if="record.commission_calculated.raw_value">✓ Calculated</span>
                                            <span class="badge badge-primary" t-if="record.commission_approved.raw_value">✓ Approved</span>
                                            <span class="badge badge-warning" t-if="record.commission_external.raw_value">External</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="osus-card-body">
                                    <div class="commission-details">
                                        <div class="detail-row">
                                            <strong>Customer:</strong> <field name="partner_id"/>
                                        </div>
                                        <div class="detail-row">
                                            <strong>Sales Person:</strong> <field name="user_id"/>
                                        </div>
                                        <div class="detail-row">
                                            <strong>Order Amount:</strong> 
                                            <field name="amount_total" widget="monetary"/>
                                        </div>
                                        <div class="detail-row commission-highlight">
                                            <strong>Commission:</strong> 
                                            <span class="osus-commission-amount">
                                                <field name="total_commission_amount" widget="monetary"/>
                                            </span>
                                            <span class="commission-rate">
                                                (<field name="commission_percentage" widget="percentage"/>)
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="kanban-actions">
                                        <button name="action_recalculate_commission" type="object" 
                                                class="btn btn-osus-secondary btn-sm"
                                                t-if="!record.commission_calculated.raw_value">
                                            Calculate
                                        </button>
                                        <button name="action_approve_commission" type="object" 
                                                class="btn btn-osus-success btn-sm"
                                                t-if="record.commission_calculated.raw_value and !record.commission_approved.raw_value">
                                            Approve
                                        </button>
                                        <button name="%(action_commission_summary_form)d" type="action" 
                                                class="btn btn-osus-primary btn-sm">
                                            Details
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        
        <!-- Commission Graph View -->
        <record id="view_commission_summary_graph" model="ir.ui.view">
            <field name="name">osus.commission.summary.graph</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <graph string="Commission Analysis" type="bar">
                    <field name="user_id" type="row"/>
                    <field name="total_commission_amount" type="measure"/>
                    <field name="amount_total" type="measure"/>
                </graph>
            </field>
        </record>
        
        <!-- Commission Pivot View -->
        <record id="view_commission_summary_pivot" model="ir.ui.view">
            <field name="name">osus.commission.summary.pivot</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <pivot string="Commission Analysis">
                    <field name="user_id" type="row"/>
                    <field name="commission_external" type="col"/>
                    <field name="total_commission_amount" type="measure"/>
                    <field name="amount_total" type="measure"/>
                    <field name="commission_percentage" type="measure"/>
                </pivot>
            </field>
        </record>
        
        <!-- Actions -->
        <record id="action_commission_summary_form" model="ir.actions.act_window">
            <field name="name">Commission Summary</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_commission_summary_form"/>
            <field name="target">current</field>
        </record>
        
        <record id="action_commission_management" model="ir.actions.act_window">
            <field name="name">Commission Management</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">kanban,tree,form,graph,pivot</field>
            <field name="view_id" ref="view_commission_summary_kanban"/>
            <field name="domain">[('total_commission_amount', '>', 0)]</field>
            <field name="context">{
                'search_default_group_by_calculated': 1,
            }</field>
            <field name="help" type="html">
                <div class="osus-help-message">
                    <div class="osus-branding-header">
                        <div class="osus-logo">
                            <div class="osus-icon">💰</div>
                            <div class="osus-title">Commission Management</div>
                        </div>
                    </div>
                    <p>Manage commission calculations and approvals for sales orders.</p>
                    <p>This system provides:</p>
                    <ul>
                        <li>💰 Automated commission calculations with commission_ax integration</li>
                        <li>🔍 External and internal commission tracking</li>
                        <li>✅ Commission approval workflows</li>
                        <li>📊 Comprehensive commission analytics</li>
                        <li>📱 Mobile-responsive commission management</li>
                    </ul>
                </div>
            </field>
        </record>
        
        <!-- Search Views -->
        <record id="view_commission_search" model="ir.ui.view">
            <field name="name">osus.commission.search</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <search string="Commission Search">
                    <field name="name" string="Order"/>
                    <field name="partner_id" string="Customer"/>
                    <field name="user_id" string="Salesperson"/>
                    
                    <filter string="Calculated" name="calculated" domain="[('commission_calculated', '=', True)]"/>
                    <filter string="Not Calculated" name="not_calculated" domain="[('commission_calculated', '=', False)]"/>
                    <filter string="Approved" name="approved" domain="[('commission_approved', '=', True)]"/>
                    <filter string="Pending Approval" name="pending_approval" domain="[('commission_calculated', '=', True), ('commission_approved', '=', False)]"/>
                    <filter string="External Commission" name="external" domain="[('commission_external', '=', True)]"/>
                    
                    <separator/>
                    <filter string="This Month" name="this_month" domain="[('commission_calculated_date', '&gt;=', datetime.datetime.now().replace(day=1).strftime('%Y-%m-%d'))]"/>
                    <filter string="Last Month" name="last_month" domain="[('commission_calculated_date', '&gt;=', (datetime.datetime.now().replace(day=1) - datetime.timedelta(days=1)).replace(day=1).strftime('%Y-%m-%d')), ('commission_calculated_date', '&lt;', datetime.datetime.now().replace(day=1).strftime('%Y-%m-%d'))]"/>
                    
                    <group expand="0" string="Group By">
                        <filter string="Salesperson" name="group_by_salesperson" context="{'group_by': 'user_id'}"/>
                        <filter string="Customer" name="group_by_customer" context="{'group_by': 'partner_id'}"/>
                        <filter string="Calculated" name="group_by_calculated" context="{'group_by': 'commission_calculated'}"/>
                        <filter string="Commission Type" name="group_by_type" context="{'group_by': 'commission_external'}"/>
                        <filter string="Calculation Date" name="group_by_date" context="{'group_by': 'commission_calculated_date'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <!-- Menu Items -->
        <menuitem id="menu_osus_commission_management" 
                  name="Commission Management"
                  parent="menu_osus_workflow_root"
                  action="action_commission_management"
                  sequence="25"/>
        
    </data>
</odoo>
