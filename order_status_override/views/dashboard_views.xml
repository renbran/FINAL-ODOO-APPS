<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- OSUS Workflow Dashboard -->
        <record id="view_workflow_dashboard" model="ir.ui.view">
            <field name="name">osus.workflow.dashboard</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <dashboard>
                    <view type="graph" ref="view_workflow_graph"/>
                    <view type="pivot" ref="view_workflow_pivot"/>
                    <group string="Workflow Analytics">
                        <aggregate name="total_orders" field="id" group_operator="count" string="Total Orders"/>
                        <aggregate name="avg_amount" field="amount_total" group_operator="avg" string="Average Amount"/>
                        <aggregate name="total_commission" field="total_commission_amount" group_operator="sum" string="Total Commission"/>
                        <aggregate name="completion_rate" field="workflow_progress" group_operator="avg" string="Avg Progress"/>
                    </group>
                </dashboard>
            </field>
        </record>
        
        <!-- Workflow Graph View -->
        <record id="view_workflow_graph" model="ir.ui.view">
            <field name="name">sale.order.workflow.graph</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <graph string="Workflow Analytics" type="bar" stacked="1">
                    <field name="custom_status_id" type="row"/>
                    <field name="amount_total" type="measure"/>
                    <field name="total_commission_amount" type="measure"/>
                </graph>
            </field>
        </record>
        
        <!-- Workflow Pivot View -->
        <record id="view_workflow_pivot" model="ir.ui.view">
            <field name="name">sale.order.workflow.pivot</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <pivot string="Workflow Analysis">
                    <field name="custom_status_id" type="row"/>
                    <field name="user_id" type="col"/>
                    <field name="amount_total" type="measure"/>
                    <field name="total_commission_amount" type="measure"/>
                    <field name="workflow_progress" type="measure"/>
                </pivot>
            </field>
        </record>
        
        <!-- Workflow Kanban View -->
        <record id="view_workflow_kanban" model="ir.ui.view">
            <field name="name">sale.order.workflow.kanban</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <kanban default_group_by="custom_status_id" class="osus-workflow-kanban">
                    <field name="id"/>
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="amount_total"/>
                    <field name="total_commission_amount"/>
                    <field name="workflow_progress"/>
                    <field name="custom_status_id"/>
                    <field name="commission_calculated"/>
                    <field name="user_id"/>
                    <field name="documentation_user_id"/>
                    <field name="commission_user_id"/>
                    <field name="final_review_user_id"/>
                    
                    <templates>
                        <t t-name="kanban-box">
                            <div class="osus-card kanban-card">
                                <div class="osus-card-header">
                                    <div class="card-title">
                                        <strong><field name="name"/></strong>
                                        <span class="float-end">
                                            <field name="workflow_progress" widget="progressbar"/>
                                        </span>
                                    </div>
                                </div>
                                <div class="osus-card-body">
                                    <div class="kanban-details">
                                        <div class="detail-row">
                                            <strong>Customer:</strong> <field name="partner_id"/>
                                        </div>
                                        <div class="detail-row">
                                            <strong>Amount:</strong> 
                                            <field name="amount_total" widget="monetary"/>
                                        </div>
                                        <div class="detail-row" t-if="record.total_commission_amount.raw_value > 0">
                                            <strong>Commission:</strong> 
                                            <field name="total_commission_amount" widget="monetary"/>
                                        </div>
                                        <div class="detail-row">
                                            <strong>Salesperson:</strong> <field name="user_id"/>
                                        </div>
                                    </div>
                                    
                                    <div class="kanban-assignments">
                                        <div class="assignment-badges">
                                            <span class="badge badge-info" t-if="record.documentation_user_id.raw_value">
                                                Doc: <field name="documentation_user_id"/>
                                            </span>
                                            <span class="badge badge-warning" t-if="record.commission_user_id.raw_value">
                                                Comm: <field name="commission_user_id"/>
                                            </span>
                                            <span class="badge badge-success" t-if="record.final_review_user_id.raw_value">
                                                Review: <field name="final_review_user_id"/>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="kanban-actions">
                                        <button name="action_change_status" type="object" 
                                                class="btn btn-osus-secondary btn-sm">
                                            Change Status
                                        </button>
                                        <button name="%(action_sale_order_enhanced_form)d" type="action" 
                                                class="btn btn-osus-primary btn-sm">
                                            Open
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        
        <!-- Enhanced Action for Sale Orders -->
        <record id="action_sale_order_enhanced_workflow" model="ir.actions.act_window">
            <field name="name">OSUS Enhanced Sales Orders</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">kanban,tree,form,graph,pivot</field>
            <field name="view_id" ref="view_workflow_kanban"/>
            <field name="context">{
                'search_default_group_by_status': 1,
            }</field>
            <field name="help" type="html">
                <div class="osus-help-message">
                    <div class="osus-branding-header">
                        <div class="osus-logo">
                            <div class="osus-icon">O</div>
                            <div class="osus-title">OSUS Enhanced Sales Workflow</div>
                        </div>
                    </div>
                    <p>Welcome to the OSUS Enhanced Sales Order Workflow!</p>
                    <p>This system provides:</p>
                    <ul>
                        <li>ðŸŽ¯ Complete workflow management: Draft â†’ Documentation â†’ Commission â†’ Review â†’ Approved â†’ Posted</li>
                        <li>ðŸ’° Integrated commission calculations with commission_ax</li>
                        <li>ðŸ‘¥ User assignment and collaboration features</li>
                        <li>ðŸ“Š Real-time progress tracking and analytics</li>
                        <li>ðŸ“± Mobile-responsive design for all devices</li>
                    </ul>
                    <p>Click "Create" to start a new sales order with enhanced workflow management.</p>
                </div>
            </field>
        </record>
        
        <!-- Enhanced Form Action -->
        <record id="action_sale_order_enhanced_form" model="ir.actions.act_window">
            <field name="name">Enhanced Order</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_order_form_enhanced_workflow"/>
            <field name="target">current</field>
        </record>
        
        <!-- Workflow Dashboard Action -->
        <record id="action_workflow_dashboard" model="ir.actions.act_window">
            <field name="name">Workflow Dashboard</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">dashboard,graph,pivot</field>
            <field name="view_id" ref="view_workflow_dashboard"/>
            <field name="context">{
                'search_default_current_month': 1,
            }</field>
        </record>
        
        <!-- Menu Items -->
        <menuitem id="menu_osus_workflow_root" 
                  name="OSUS Workflow" 
                  sequence="15"
                  web_icon="order_status_override,static/description/icon.png"/>
        
        <menuitem id="menu_osus_enhanced_orders" 
                  name="Enhanced Sales Orders"
                  parent="menu_osus_workflow_root"
                  action="action_sale_order_enhanced_workflow"
                  sequence="10"/>
        
        <menuitem id="menu_osus_workflow_dashboard" 
                  name="Workflow Dashboard"
                  parent="menu_osus_workflow_root"
                  action="action_workflow_dashboard"
                  sequence="20"/>
        
        <menuitem id="menu_osus_workflow_config" 
                  name="Configuration"
                  parent="menu_osus_workflow_root"
                  sequence="30"/>
        
        <menuitem id="menu_osus_order_status" 
                  name="Order Statuses"
                  parent="menu_osus_workflow_config"
                  action="order_status_override.action_order_status"
                  sequence="10"/>
        
        <!-- Sales Menu Integration -->
        <menuitem id="menu_sales_enhanced_orders" 
                  name="Enhanced Orders"
                  parent="sale.sale_menu_root"
                  action="action_sale_order_enhanced_workflow"
                  sequence="5"/>
        
    </data>
</odoo>
