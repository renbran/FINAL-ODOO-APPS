<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- OSUS Enhanced Workflow Assets -->
        <template id="assets_backend" inherit_id="web.assets_backend">
            <!-- OSUS Branding CSS -->
            <link rel="stylesheet" type="text/scss" href="/order_status_override/static/src/scss/osus_branding.scss"/>
            
            <!-- Workflow Components CSS -->
            <link rel="stylesheet" type="text/scss" href="/order_status_override/static/src/scss/workflow_components.scss"/>
            
            <!-- Mobile Responsive CSS -->
            <link rel="stylesheet" type="text/scss" href="/order_status_override/static/src/scss/mobile_responsive.scss"/>
            
            <!-- JavaScript Components -->
            <script type="text/javascript" src="/order_status_override/static/src/js/workflow_manager.js"/>
            <script type="text/javascript" src="/order_status_override/static/src/js/commission_calculator.js"/>
            <script type="text/javascript" src="/order_status_override/static/src/js/status_dashboard.js"/>
        </template>
        
        <!-- Frontend Portal Assets -->
        <template id="assets_frontend" inherit_id="web.assets_frontend">
            <!-- Portal CSS -->
            <link rel="stylesheet" type="text/scss" href="/order_status_override/static/src/scss/frontend_portal.scss"/>
            
            <!-- Portal JavaScript -->
            <script type="text/javascript" src="/order_status_override/static/src/js/portal_workflow.js"/>
        </template>
        
        <!-- OWL Templates for JavaScript Components -->
        <template id="WorkflowManagerTemplate" name="order_status_override.WorkflowManagerTemplate">
            <div class="osus-workflow-manager" t-if="!state.isLoading">
                <div class="osus-workflow-progress">
                    <div class="workflow-steps">
                        <t t-foreach="state.workflowSteps" t-as="step" t-key="step.id">
                            <div class="workflow-step" t-att-data-status="step.code">
                                <div class="step-circle" 
                                     t-att-class="{
                                         'completed': step.sequence &lt; state.currentStatus.sequence,
                                         'active': step.code === state.currentStatus.code,
                                         'pending': step.sequence &gt; state.currentStatus.sequence
                                     }">
                                    <t t-esc="step.sequence"/>
                                </div>
                                <div class="step-label" t-esc="step.name"/>
                            </div>
                        </t>
                    </div>
                </div>
                
                <div class="osus-workflow-actions" t-if="state.canTransition">
                    <div class="action-header">
                        <div class="action-icon">‚ö°</div>
                        <div class="action-title">Available Actions</div>
                    </div>
                    <div class="action-buttons">
                        <t t-foreach="state.nextActions" t-as="action" t-key="action">
                            <button class="btn btn-osus-primary workflow-action-btn" 
                                    t-att-data-action="action"
                                    t-on-click="handleActionClick"
                                    t-if="canPerformAction(action)">
                                <t t-esc="getActionLabel(action)"/>
                            </button>
                        </t>
                    </div>
                </div>
                
                <div class="osus-assignment-panel" t-if="state.assignedUsers">
                    <div class="assignment-header">
                        <span class="header-icon">üë•</span>
                        Current Assignments
                    </div>
                    <div class="assignment-body">
                        <div class="assignment-row" t-if="state.assignedUsers.documentation">
                            <div class="assignment-role">Documentation</div>
                            <div class="assignment-user" t-esc="state.assignedUsers.documentation"/>
                        </div>
                        <div class="assignment-row" t-if="state.assignedUsers.commission">
                            <div class="assignment-role">Commission</div>
                            <div class="assignment-user" t-esc="state.assignedUsers.commission"/>
                        </div>
                        <div class="assignment-row" t-if="state.assignedUsers.final_review">
                            <div class="assignment-role">Final Review</div>
                            <div class="assignment-user" t-esc="state.assignedUsers.final_review"/>
                        </div>
                    </div>
                </div>
            </div>
            
            <div t-if="state.isLoading" class="osus-loading">
                <div class="loading-spinner">‚è≥</div>
                <div class="loading-message">Processing workflow action...</div>
            </div>
        </template>
        
        <template id="CommissionCalculatorTemplate" name="order_status_override.CommissionCalculatorTemplate">
            <div class="osus-commission-calculator" t-if="!state.isLoading">
                <div class="calculator-header">
                    Commission Calculation &amp; Management
                </div>
                
                <div class="commission-summary" t-if="state.commissionData">
                    <div class="summary-item">
                        <div class="summary-label">Order Total</div>
                        <div class="summary-value" t-esc="calculationSummary.orderTotal"/>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total Commission</div>
                        <div class="summary-value" t-esc="calculationSummary.totalCommission"/>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">External Commission</div>
                        <div class="summary-value" t-esc="calculationSummary.totalExternal"/>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Internal Commission</div>
                        <div class="summary-value" t-esc="calculationSummary.totalInternal"/>
                    </div>
                </div>
                
                <div class="commission-actions" t-if="!props.readonly">
                    <button class="btn btn-osus-primary" t-on-click="calculatePreview">
                        üîÑ Calculate Preview
                    </button>
                    <button class="btn btn-osus-gold" t-on-click="applyCommissions" 
                            t-if="canApplyCommissions">
                        ‚úì Apply Commissions
                    </button>
                </div>
                
                <div class="commission-details" t-if="state.showAdvanced">
                    <h4>External Commissions</h4>
                    <t t-foreach="state.commissionData.external_commissions" t-as="commission" t-key="commission.id">
                        <div class="commission-entry">
                            <span t-esc="commission.commission_group"/>: 
                            <span t-esc="formatCurrency(commission.amount_fixed)"/>
                        </div>
                    </t>
                    
                    <h4>Internal Commissions</h4>
                    <t t-foreach="state.commissionData.internal_commissions" t-as="commission" t-key="commission.id">
                        <div class="commission-entry">
                            <span t-esc="commission.commission_group"/>: 
                            <span t-esc="formatCurrency(commission.amount_fixed)"/>
                        </div>
                    </t>
                </div>
            </div>
            
            <div t-if="state.isLoading" class="osus-loading">
                <div class="loading-spinner">üí∞</div>
                <div class="loading-message">Calculating commissions...</div>
            </div>
        </template>
        
    </data>
</odoo>
