<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Inherit form view of account.move model for vendor bills -->
    <record id="view_move_form_inherit_payment_approval" model="ir.ui.view">
        <field name="name">account.move.form.inherit.payment.approval</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <!-- Modify cancel button visibility for vendor bills -->
            <xpath expr="//header//button[@name='button_cancel']" position="attributes">
                <attribute name="invisible">state not in ['draft', 'waiting_approval', 'approved'] or move_type not in ['in_invoice', 'in_refund']</attribute>
            </xpath>
            
            <!-- Ensure draft button is visible for vendor bills in new states -->
            <xpath expr="//header//button[@name='button_draft']" position="attributes">
                <attribute name="invisible">state not in ['cancel', 'rejected'] or move_type not in ['in_invoice', 'in_refund']</attribute>
            </xpath>
            
            <!-- Add approval-specific buttons for vendor bills if needed -->
            <xpath expr="//header//button[@name='button_cancel']" position="before">
                <!-- Submit for Review button for vendor bills -->
                <button name="action_submit_review" string="Submit for Review" type="object"
                        class="oe_highlight" 
                        invisible="state != 'draft' or move_type not in ['in_invoice', 'in_refund']"/>
                
                <!-- Approve button for vendor bills -->
                <button name="approve_transfer" string="Approve" type="object"
                        class="oe_highlight"
                        invisible="state != 'waiting_approval' or move_type not in ['in_invoice', 'in_refund']"/>
                
                <!-- Reject button for vendor bills -->
                <button name="reject_transfer" string="Reject" type="object"
                        class="oe_highlight" 
                        invisible="state != 'waiting_approval' or move_type not in ['in_invoice', 'in_refund']"/>
            </xpath>
        </field>
    </record>

    <!-- Inherit tree view of account.move model to show approval states -->
    <record id="view_move_tree_inherit_payment_approval" model="ir.ui.view">
        <field name="name">account.move.tree.inherit.payment.approval</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_tree"/>
        <field name="arch" type="xml">
            <!-- Modify state field to show new approval states -->
            <xpath expr="//field[@name='state']" position="attributes">
                <attribute name="widget">badge</attribute>
                <attribute name="decoration-info">state in ('waiting_approval', 'submit_review')</attribute>
                <attribute name="decoration-success">state == 'approved'</attribute>
                <attribute name="decoration-danger">state == 'rejected'</attribute>
            </xpath>
        </field>
    </record>

    <!-- Add search filters for vendor bills with approval states -->
    <record id="view_account_move_filter_inherit_payment_approval" model="ir.ui.view">
        <field name="name">account.move.search.inherit.payment.approval</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <!-- Add filters for approval states on vendor bills -->
                <separator/>
                <filter string="Waiting For Approval" name="state_waiting_approval"
                        domain="[('state', '=', 'waiting_approval'), ('move_type', 'in', ['in_invoice', 'in_refund'])]"/>
                <filter string="Approved" name="state_approved"
                        domain="[('state', '=', 'approved'), ('move_type', 'in', ['in_invoice', 'in_refund'])]"/>
                <filter string="Rejected" name="state_rejected"
                        domain="[('state', '=', 'rejected'), ('move_type', 'in', ['in_invoice', 'in_refund'])]"/>
                
                <!-- Group by state for bills -->
                <group expand="0" string="Group By">
                    <filter string="Approval State" name="group_by_state" 
                            context="{'group_by': 'state'}"
                            domain="[('move_type', 'in', ['in_invoice', 'in_refund'])]"/>
                </group>
            </xpath>
        </field>
    </record>
</odoo>
