<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Enhanced Payment Form View -->
    <record id="view_account_payment_form_enhanced" model="ir.ui.view">
        <field name="name">account.payment.form.enhanced</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="arch" type="xml">
            <!-- Add voucher_state status bar -->
            <xpath expr="//field[@name='state']" position="after">
                <field name="voucher_state" widget="statusbar" statusbar_visible="draft,submitted,under_review,approved,authorized,posted"/>
            </xpath>

            <!-- Add approval workflow buttons -->
            <xpath expr="//header" position="inside">
                <!-- Submit for Approval -->
                <button name="action_submit_for_approval" string="Submit for Approval" type="object" class="btn-primary" invisible="voucher_state != 'draft' or not requires_approval"/>

                <!-- Review -->
                <button name="action_review" string="Review" type="object" class="btn-info" invisible="voucher_state != 'submitted' or not is_approve_person"/>

                <!-- Approve -->
                <button name="action_approve" string="Approve" type="object" class="btn-success" invisible="voucher_state != 'under_review' or not is_approve_person"/>

                <!-- Authorize -->
                <button name="action_authorize" string="Authorize" type="object" class="btn-success" invisible="voucher_state not in ['approved', 'under_review'] or not is_approve_person"/>

                <!-- Reject -->
                <button name="action_reject" string="Reject" type="object" class="btn-danger" invisible="voucher_state not in ['submitted', 'under_review', 'approved'] or not is_approve_person"/>

                <!-- Reset to Draft -->
                <button name="action_reset_to_draft" string="Reset to Draft" type="object" class="btn-secondary" invisible="voucher_state not in ['rejected']"/>
            </xpath>

            <!-- Add voucher information after amount field -->
            <xpath expr="//field[@name='amount']" position="after">
                <field name="voucher_number" readonly="1"/>
                <field name="voucher_type" readonly="1"/>
                <field name="requires_approval" invisible="1"/>
                <field name="is_approve_person" invisible="1"/>
            </xpath>

            <!-- Add QR verification button -->
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <button name="action_qr_verification_view" type="object" class="oe_stat_button" icon="fa-qrcode" string="QR Verify"/>
            </xpath>

            <!-- Add approval information tab -->
            <xpath expr="//notebook" position="inside">
                <page string="Approval Information" invisible="not requires_approval">
                    <group>
                        <group string="Workflow Status">
                            <field name="reviewer_id" readonly="1"/>
                            <field name="approver_id" readonly="1"/>
                            <field name="authorizer_id" readonly="1"/>
                        </group>
                        <group string="Workflow Dates">
                            <field name="submitted_date" readonly="1"/>
                            <field name="reviewed_date" readonly="1"/>
                            <field name="approved_date" readonly="1"/>
                            <field name="authorized_date" readonly="1"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Enhanced Payment List View -->
    <record id="view_account_payment_tree_enhanced" model="ir.ui.view">
        <field name="name">account.payment.tree.enhanced</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_tree"/>
        <field name="arch" type="xml">
            <!-- Add voucher fields to tree view -->
            <xpath expr="//field[@name='name']" position="after">
                <field name="voucher_number" optional="show"/>
                <field name="voucher_type" optional="hide"/>
            </xpath>

            <!-- Add approval fields -->
            <xpath expr="//field[@name='state']" position="after">
                <field name="voucher_state" optional="show"/>
                <field name="requires_approval" optional="hide"/>
                <field name="reviewer_id" optional="hide"/>
                <field name="approver_id" optional="hide"/>
            </xpath>
        </field>
    </record>

    <!-- Search view enhancements -->
    <record id="view_account_payment_search_enhanced" model="ir.ui.view">
        <field name="name">account.payment.search.enhanced</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_search"/>
        <field name="arch" type="xml">
            <!-- Add approval-related filters -->
            <xpath expr="//filter[@name='state_posted']" position="after">
                <separator/>
                <filter name="voucher_state_submitted" string="Submitted" domain="[('voucher_state', '=', 'submitted')]"/>
                <filter name="voucher_state_under_review" string="Under Review" domain="[('voucher_state', '=', 'under_review')]"/>
                <filter name="voucher_state_approved" string="Approved" domain="[('voucher_state', '=', 'approved')]"/>
                <filter name="voucher_state_authorized" string="Authorized" domain="[('voucher_state', '=', 'authorized')]"/>
                <filter name="voucher_state_rejected" string="Rejected" domain="[('voucher_state', '=', 'rejected')]"/>
                <separator/>
                <filter name="requires_approval" string="Requires Approval" domain="[('requires_approval', '=', True)]"/>
                <filter name="can_approve" string="I Can Approve" domain="[('is_approve_person', '=', True)]"/>
            </xpath>

            <!-- Add groupby options -->
            <xpath expr="//group" position="inside">
                <filter string="Voucher Type" name="group_voucher_type" domain="[]" context="{'group_by': 'voucher_type'}"/>
                <filter string="Reviewer" name="group_reviewer" domain="[]" context="{'group_by': 'reviewer_id'}"/>
                <filter string="Approver" name="group_approver" domain="[]" context="{'group_by': 'approver_id'}"/>
            </xpath>

            <!-- Add search fields -->
            <xpath expr="//field[@name='name']" position="after">
                <field name="voucher_number"/>
                <field name="reviewer_id"/>
                <field name="approver_id"/>
                <field name="authorizer_id"/>
            </xpath>
        </field>
    </record>
</odoo>
