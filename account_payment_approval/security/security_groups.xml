<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- Payment Approval User Group -->
        <record id="group_payment_approval_user" model="res.groups">
            <field name="name">Payment Approval User</field>
            <field name="category_id" ref="base.module_category_accounting_accounting"/>
            <field name="comment">Can create and submit payments for approval</field>
        </record>

        <!-- Payment Approval Reviewer Group -->
        <record id="group_payment_approval_reviewer" model="res.groups">
            <field name="name">Payment Approval Reviewer</field>
            <field name="category_id" ref="base.module_category_accounting_accounting"/>
            <field name="implied_ids" eval="[(4, ref('group_payment_approval_user'))]"/>
            <field name="comment">Can review and approve payments</field>
        </record>

        <!-- Payment Approval Manager Group -->
        <record id="group_payment_approval_manager" model="res.groups">
            <field name="name">Payment Approval Manager</field>
            <field name="category_id" ref="base.module_category_accounting_accounting"/>
            <field name="implied_ids" eval="[(4, ref('group_payment_approval_reviewer'))]"/>
            <field name="comment">Can authorize approved payments and perform bulk operations</field>
        </record>

        <!-- Payment Approval Administrator Group -->
        <record id="group_payment_approval_administrator" model="res.groups">
            <field name="name">Payment Approval Administrator</field>
            <field name="category_id" ref="base.module_category_accounting_accounting"/>
            <field name="implied_ids" eval="[(4, ref('group_payment_approval_manager'))]"/>
            <field name="comment">Full access to payment approval system and configuration</field>
        </record>

        <!-- Record Rules -->
        
        <!-- Payment Approval User Rule -->
        <record id="payment_approval_user_rule" model="ir.rule">
            <field name="name">Payment Approval: User Access</field>
            <field name="model_id" ref="account.model_account_payment"/>
            <field name="domain_force">[('create_uid', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_payment_approval_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Payment Approval Reviewer Rule -->
        <record id="payment_approval_reviewer_rule" model="ir.rule">
            <field name="name">Payment Approval: Reviewer Access</field>
            <field name="model_id" ref="account.model_account_payment"/>
            <field name="domain_force">['|', 
                ('create_uid', '=', user.id),
                '|',
                ('reviewer_id', '=', user.id),
                ('voucher_state', 'in', ['submitted', 'under_review'])
            ]</field>
            <field name="groups" eval="[(4, ref('group_payment_approval_reviewer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Payment Approval Manager Rule -->
        <record id="payment_approval_manager_rule" model="ir.rule">
            <field name="name">Payment Approval: Manager Access</field>
            <field name="model_id" ref="account.model_account_payment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_payment_approval_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Multi-company Rule -->
        <record id="payment_approval_multi_company_rule" model="ir.rule">
            <field name="name">Payment Approval: Multi-company</field>
            <field name="model_id" ref="account.model_account_payment"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- Configuration Security -->
        <record id="payment_approval_config_rule" model="ir.rule">
            <field name="name">Payment Approval Config: Admin Only</field>
            <field name="model_id" ref="model_payment_approval_config"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_payment_approval_administrator'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Wizard Security Rules -->
        <record id="payment_rejection_wizard_rule" model="ir.rule">
            <field name="name">Payment Rejection Wizard: Reviewer Access</field>
            <field name="model_id" ref="model_payment_rejection_wizard"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_payment_approval_reviewer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="payment_bulk_approval_wizard_rule" model="ir.rule">
            <field name="name">Payment Bulk Approval Wizard: Manager Access</field>
            <field name="model_id" ref="model_payment_bulk_approval_wizard"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_payment_approval_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Report Security -->
        <record id="payment_approval_report_rule" model="ir.rule">
            <field name="name">Payment Approval Report: Manager Access</field>
            <field name="model_id" ref="model_payment_approval_report"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_payment_approval_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

    </data>
</odoo>
