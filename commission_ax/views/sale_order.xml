<odoo>
    <record id="view_order_form_inherit_commission_enhanced" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.commission.enhanced</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <!-- Add sales_value field in header -->
            <xpath expr="//field[@name='client_order_ref']" position="after">
                <field name="sales_value"/>
            </xpath>

            <!-- Add commission buttons -->
            <xpath expr="//header" position="inside">
                <button name="action_process_commissions" type="object" string="Calculate Commissions" class="btn-primary" invisible="commission_status != 'draft'"/>
                <button name="action_confirm_commissions" type="object" string="Confirm Commissions" class="btn-primary" invisible="commission_status != 'calculated'"/>
                <button name="action_reset_commissions" type="object" string="Reset to Draft" invisible="commission_status == 'draft'"/>
            </xpath>

            <!-- Add commission section -->
            <xpath expr="//notebook" position="inside">
                <page string="Commissions">
                    <group>
                        <group string="Commission Summary">
                            <field name="total_external_commission_amount" readonly="1"/>
                            <field name="total_internal_commission_amount" readonly="1"/>
                            <field name="total_commission_amount" readonly="1"/>
                            <field name="company_share" readonly="1"/>
                            <field name="net_company_share" readonly="1"/>
                            <field name="commission_status"/>
                        </group>
                        <group string="Commission Controls">
                            <field name="commission_processed" readonly="1"/>
                            <widget name="statinfo" string="POs Generated">
                                <field name="purchase_order_count"/>
                            </widget>
                        </group>
                    </group>

                    <notebook>
                        <page string="External Commissions">
                            <group>
                                <group string="Broker">
                                    <field name="broker_partner_id"/>
                                    <field name="broker_commission_type"/>
                                    <field name="broker_rate"/>
                                    <field name="broker_amount"/>
                                </group>
                                <group string="Referrer">
                                    <field name="referrer_partner_id"/>
                                    <field name="referrer_commission_type"/>
                                    <field name="referrer_rate"/>
                                    <field name="referrer_amount"/>
                                </group>
                                <group string="Cashback">
                                    <field name="cashback_partner_id"/>
                                    <field name="cashback_commission_type"/>
                                    <field name="cashback_rate"/>
                                    <field name="cashback_amount"/>
                                </group>
                                <group string="Other External">
                                    <field name="other_external_partner_id"/>
                                    <field name="other_external_commission_type"/>
                                    <field name="other_external_rate"/>
                                    <field name="other_external_amount"/>
                                </group>
                            </group>
                        </page>

                        <page string="Internal Commissions">
                            <group>
                                <group string="Agent 1">
                                    <field name="agent1_partner_id"/>
                                    <field name="agent1_commission_type"/>
                                    <field name="agent1_rate"/>
                                    <field name="agent1_amount"/>
                                </group>
                                <group string="Agent 2">
                                    <field name="agent2_partner_id"/>
                                    <field name="agent2_commission_type"/>
                                    <field name="agent2_rate"/>
                                    <field name="agent2_amount"/>
                                </group>
                                <group string="Manager">
                                    <field name="manager_partner_id"/>
                                    <field name="manager_commission_type"/>
                                    <field name="manager_rate"/>
                                    <field name="manager_amount"/>
                                </group>
                                <group string="Director">
                                    <field name="director_partner_id"/>
                                    <field name="director_commission_type"/>
                                    <field name="director_rate"/>
                                    <field name="director_amount"/>
                                </group>
                            </group>
                        </page>

                        <page string="Generated POs" invisible="purchase_order_count == 0">
                            <field name="purchase_order_ids">
                                <tree>
                                    <field name="name"/>
                                    <field name="partner_id"/>
                                    <field name="amount_total"/>
                                    <field name="state"/>
                                </tree>
                                <form>
                                    <sheet>
                                        <group>
                                            <field name="name"/>
                                            <field name="partner_id"/>
                                            <field name="origin"/>
                                            <field name="date_order"/>
                                            <field name="amount_total"/>
                                            <field name="state"/>
                                        </group>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </page>
            </xpath>
        </field>
    </record>
</odoo>