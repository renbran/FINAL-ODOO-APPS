<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Sale Order Form View with Commission Tab -->
    <record id="view_order_form_commission" model="ir.ui.view">
        <field name="name">sale.order.form.commission</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook" position="inside">
                <page string="Commissions" name="commissions">
                    <group>
                        <group string="Commission Status">
                            <field name="commission_status"/>
                            <field name="commission_processed"/>
                            <field name="purchase_order_count" modifiers='{"invisible": true}'/>
                        </group>
                        <group string="Commission Summary">
                            <field name="total_commission_rate" widget="percentage"/>
                            <field name="total_commission_amount" widget="monetary"/>
                            <field name="company_share" widget="monetary"/>
                        </group>
                    </group>
                    
                    <group string="External Commissions">
                        <group string="External Commission Summary">
                            <field name="total_external_commission_rate" widget="percentage"/>
                            <field name="total_external_commission_amount" widget="monetary"/>
                        </group>
                    </group>
                    
                    <!-- Broker Commission -->
                    <group string="Broker Commission">
                        <group>
                            <field name="broker_partner_id"/>
                            <field name="broker_commission_type"/>
                        </group>
                        <group>
                            <field name="broker_rate" modifiers='{"invisible": [["=", "broker_commission_type", "fixed_amount"]]}'/>
                            <field name="broker_fixed_amount" modifiers='{"invisible": [["!=", "broker_commission_type", "fixed_amount"]]}'/>
                            <field name="broker_amount" widget="monetary"/>
                        </group>
                    </group>
                    
                    <!-- Referrer Commission -->
                    <group string="Referrer Commission">
                        <group>
                            <field name="referrer_partner_id"/>
                            <field name="referrer_commission_type"/>
                        </group>
                        <group>
                            <field name="referrer_rate" modifiers='{"invisible": [["=", "referrer_commission_type", "fixed_amount"]]}'/>
                            <field name="referrer_fixed_amount" modifiers='{"invisible": [["!=", "referrer_commission_type", "fixed_amount"]]}'/>
                            <field name="referrer_amount" widget="monetary"/>
                        </group>
                    </group>
                    
                    <!-- Cashback Commission -->
                    <group string="Cashback">
                        <group>
                            <field name="cashback_partner_id"/>
                            <field name="cashback_commission_type"/>
                        </group>
                        <group>
                            <field name="cashback_rate" modifiers='{"invisible": [["=", "cashback_commission_type", "fixed_amount"]]}'/>
                            <field name="cashback_fixed_amount" modifiers='{"invisible": [["!=", "cashback_commission_type", "fixed_amount"]]}'/>
                            <field name="cashback_amount" widget="monetary"/>
                        </group>
                    </group>
                    
                    <!-- Other External Commission -->
                    <group string="Other External Party">
                        <group>
                            <field name="other_external_partner_id"/>
                            <field name="other_external_commission_type"/>
                        </group>
                        <group>
                            <field name="other_external_rate" modifiers='{"invisible": [["=", "other_external_commission_type", "fixed_amount"]]}'/>
                            <field name="other_external_fixed_amount" modifiers='{"invisible": [["!=", "other_external_commission_type", "fixed_amount"]]}'/>
                            <field name="other_external_amount" widget="monetary"/>
                        </group>
                    </group>
                    
                    <separator string="Internal Commissions"/>
                    
                    <group string="Internal Commissions">
                        <group string="Internal Commission Summary">
                            <field name="total_internal_commission_rate" widget="percentage"/>
                            <field name="total_internal_commission_amount" widget="monetary"/>
                        </group>
                    </group>
                    
                    <!-- Agent 1 Commission -->
                    <group string="Agent 1 Commission">
                        <group>
                            <field name="agent1_partner_id"/>
                            <field name="agent1_commission_type"/>
                        </group>
                        <group>
                            <field name="agent1_rate" modifiers='{"invisible": [["=", "agent1_commission_type", "fixed_amount"]]}'/>
                            <field name="agent1_fixed_amount" modifiers='{"invisible": [["!=", "agent1_commission_type", "fixed_amount"]]}'/>
                            <field name="agent1_amount" widget="monetary"/>
                        </group>
                    </group>
                    
                    <!-- Agent 2 Commission -->
                    <group string="Agent 2 Commission">
                        <group>
                            <field name="agent2_partner_id"/>
                            <field name="agent2_commission_type"/>
                        </group>
                        <group>
                            <field name="agent2_rate" modifiers='{"invisible": [["=", "agent2_commission_type", "fixed_amount"]]}'/>
                            <field name="agent2_fixed_amount" modifiers='{"invisible": [["!=", "agent2_commission_type", "fixed_amount"]]}'/>
                            <field name="agent2_amount" widget="monetary"/>
                        </group>
                    </group>
                    
                    <!-- Manager Commission -->
                    <group string="Manager Commission">
                        <group>
                            <field name="manager_partner_id" required="1"/>
                            <field name="manager_commission_type" required="1"/>
                        </group>
                        <group>
                            <field name="manager_rate" modifiers='{"invisible": [["=", "manager_commission_type", "fixed_amount"]]}' required="1"/>
                            <field name="manager_fixed_amount" modifiers='{"invisible": [["!=", "manager_commission_type", "fixed_amount"]]}' required="1"/>
                            <field name="manager_amount" widget="monetary"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
</odoo>