<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Account Payment Form View Enhancement -->
    <record id="view_account_payment_form_inherit_osus" model="ir.ui.view">
        <field name="name">account.payment.form.osus.voucher</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="arch" type="xml">
            <!-- Add Print Voucher button to header -->
            <xpath expr="//header" position="inside">
                <button name="action_print_voucher" 
                        string="Print Voucher" 
                        type="object" 
                        class="btn-primary" 
                        invisible="state != 'posted'" 
                        icon="fa-print"/>
            </xpath>
            
            <!-- Add destination account field after journal -->
            <field name="journal_id" position="after">
                <field name="destination_account_id" 
                       string="Destination Account" 
                       options="{'no_create': True, 'no_create_edit': True}" 
                       invisible="state == 'posted'" 
                       domain="[('account_type', 'in', ['asset_receivable', 'liability_payable', 'asset_cash', 'liability_credit_card'])]"/>
            </field>
            
            <!-- Modify payment reference field to be always visible -->
            <field name="partner_id" position="after">
                <field name="name" 
                       string="Reference Number" 
                       readonly="0"
                       help="Payment/Receipt reference number that will appear on the voucher"/>
                <field name="ref" 
                       string="Payment Reference"
                       placeholder="Enter payment reference or memo..."
                       help="Additional reference information"/>
            </field>
            
            <!-- Add notebook with journal items after the main form content -->
            <xpath expr="//sheet" position="inside">
                <notebook>
                    <page string="Journal Items" name="journal_items">
                        <field name="move_id" invisible="1"/>
                        <field name="line_ids" 
                               widget="one2many_list" 
                               readonly="1" 
                               context="{'default_move_id': move_id}">
                            <tree string="Journal Items" 
                                  editable="false" 
                                  create="false" 
                                  delete="false">
                                <field name="date"/>
                                <field name="account_id" options="{'no_create': True}"/>
                                <field name="name"/>
                                <field name="partner_id" options="{'no_create': True}"/>
                                <field name="analytic_distribution" 
                                       widget="analytic_distribution" 
                                       groups="analytic.group_analytic_accounting"/>
                                <field name="debit" sum="Total Debit"/>
                                <field name="credit" sum="Total Credit"/>
                                <field name="amount_currency" groups="base.group_multi_currency"/>
                                <field name="currency_id" 
                                       groups="base.group_multi_currency" 
                                       options="{'no_create': True}"/>
                                <field name="reconciled" invisible="1"/>
                                <field name="company_id" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                    
                    <!-- Add Voucher Preview Tab -->
                    <page string="Voucher Preview" name="voucher_preview">
                        <group string="Voucher Information">
                            <group>
                                <field name="name" string="Voucher Number" readonly="1"/>
                                <field name="date" string="Voucher Date"/>
                                <field name="payment_type" string="Voucher Type"/>
                            </group>
                            <group>
                                <field name="amount" string="Voucher Amount"/>
                                <field name="currency_id" string="Currency"/>
                                <field name="state" string="Status"/>
                            </group>
                        </group>
                        
                        <group string="Print Options">
                            <button name="action_print_voucher" 
                                    string="Preview/Print Voucher" 
                                    type="object" 
                                    class="btn-info" 
                                    invisible="state not in ['posted', 'sent']"
                                    icon="fa-eye"/>
                        </group>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>

    <!-- Account Payment Tree View Enhancement -->
    <record id="view_account_payment_tree_inherit_osus" model="ir.ui.view">
        <field name="name">account.payment.tree.osus.voucher</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_tree"/>
        <field name="arch" type="xml">
            <!-- Make reference number always visible in tree view -->
            <field name="name" position="attributes">
                <attribute name="string">Reference Number</attribute>
                <attribute name="optional">show</attribute>
            </field>
            
            <!-- Add voucher memo field after date -->
            <field name="date" position="after">
                <field name="ref" string="Payment Memo" optional="hide"/>
            </field>
        </field>
    </record>

    <!-- Account Payment Search View Enhancement -->
    <record id="view_account_payment_search_inherit_osus" model="ir.ui.view">
        <field name="name">account.payment.search.osus.voucher</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_search"/>
        <field name="arch" type="xml">
            <!-- Add search by reference number -->
            <field name="name" position="attributes">
                <attribute name="string">Reference Number</attribute>
                <attribute name="filter_domain">[('name', 'ilike', self)]</attribute>
            </field>
            
            <!-- Add search by payment reference -->
            <field name="name" position="after">
                <field name="ref" string="Payment Reference"/>
            </field>
        </field>
    </record>
</odoo>
