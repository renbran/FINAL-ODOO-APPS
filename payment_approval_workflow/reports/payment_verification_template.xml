<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Payment Verification Template -->
        <template id="payment_verification_template" name="Payment Verification">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True"/>

                <t t-call="portal.portal_searchbar">
                    <t t-set="title">Payment Verification</t>
                </t>

                <div class="container mt-4">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            
                            <!-- Header -->
                            <div class="card shadow-sm">
                                <div class="card-header text-center" style="background-color: #800020; color: white;">
                                    <h2 class="mb-0">
                                        <i class="fa fa-check-circle mr-2"></i>
                                        Payment Verification
                                    </h2>
                                </div>

                                <div class="card-body">
                                    
                                    <!-- Success Message -->
                                    <div class="alert alert-success text-center" role="alert">
                                        <i class="fa fa-shield-alt fa-2x mb-2" style="color: #28a745;"></i>
                                        <h4>Payment Verified Successfully</h4>
                                        <p class="mb-0">This payment has been authenticated and confirmed.</p>
                                    </div>

                                    <!-- Payment Details -->
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h5 style="color: #800020; border-bottom: 2px solid #800020; padding-bottom: 5px;">
                                                Payment Information
                                            </h5>
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td><strong>Reference:</strong></td>
                                                    <td><span t-esc="payment.name"/></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Amount:</strong></td>
                                                    <td>
                                                        <span class="h5 text-success">
                                                            <span t-esc="currency.symbol"/>
                                                            <span t-esc="'{:,.2f}'.format(amount)"/>
                                                        </span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Date:</strong></td>
                                                    <td><span t-esc="payment_date"/></td>
                                                </tr>
                                                <tr t-if="reference">
                                                    <td><strong>Reference:</strong></td>
                                                    <td><span t-esc="reference"/></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Status:</strong></td>
                                                    <td>
                                                        <span class="badge badge-success badge-lg">
                                                            <i class="fa fa-check mr-1"></i>
                                                            <span t-esc="state_display"/>
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>

                                        <div class="col-md-6">
                                            <h5 style="color: #800020; border-bottom: 2px solid #800020; padding-bottom: 5px;">
                                                Partner Information
                                            </h5>
                                            <div class="mt-3">
                                                <div class="mb-2">
                                                    <strong><span t-esc="partner_name"/></strong>
                                                </div>
                                                <div class="text-muted">
                                                    Payment Partner
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Company Information -->
                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <h5 style="color: #800020; border-bottom: 2px solid #800020; padding-bottom: 5px;">
                                                Issued By
                                            </h5>
                                            <div class="mt-3">
                                                <div class="d-flex align-items-center">
                                                    <div t-if="company.logo" class="mr-3">
                                                        <img t-att-src="'data:image/png;base64,%s' % company.logo.decode('ascii')" 
                                                             style="max-height: 60px;" 
                                                             t-att-alt="company.name"/>
                                                    </div>
                                                    <div>
                                                        <h6 class="mb-1"><span t-esc="company.name"/></h6>
                                                        <div class="text-muted">
                                                            <div t-if="company.street"><span t-esc="company.street"/></div>
                                                            <div t-if="company.city">
                                                                <span t-esc="company.city"/>
                                                                <span t-if="company.state_id">, <span t-esc="company.state_id.name"/></span>
                                                                <span t-if="company.zip"> <span t-esc="company.zip"/></span>
                                                            </div>
                                                            <div t-if="company.country_id"><span t-esc="company.country_id.name"/></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Security Notice -->
                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <div class="alert alert-info">
                                                <i class="fa fa-info-circle mr-2"></i>
                                                <strong>Security Notice:</strong> This verification page confirms the authenticity of the payment. 
                                                The payment details shown above have been digitally verified and are accurate as of the time of verification.
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <!-- Footer -->
                                <div class="card-footer text-center" style="background-color: #f8f9fa;">
                                    <small class="text-muted">
                                        Verified on <span t-esc="datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')"/> UTC
                                    </small>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>

                <!-- Custom CSS -->
                <style>
                    .badge-lg {
                        font-size: 0.9em;
                        padding: 0.5em 0.75em;
                    }
                    .card {
                        border: none;
                        border-radius: 10px;
                    }
                    .card-header {
                        border-radius: 10px 10px 0 0 !important;
                    }
                    .table td {
                        padding: 0.5rem 0.75rem;
                        border: none;
                    }
                    .alert {
                        border-radius: 8px;
                    }
                </style>

            </t>
        </template>

        <!-- Payment Not Found Template -->
        <template id="payment_not_found" name="Payment Not Found">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True"/>

                <t t-call="portal.portal_searchbar">
                    <t t-set="title">Payment Not Found</t>
                </t>

                <div class="container mt-4">
                    <div class="row justify-content-center">
                        <div class="col-lg-6">
                            
                            <div class="card shadow-sm">
                                <div class="card-header text-center" style="background-color: #dc3545; color: white;">
                                    <h2 class="mb-0">
                                        <i class="fa fa-exclamation-triangle mr-2"></i>
                                        Payment Not Found
                                    </h2>
                                </div>

                                <div class="card-body text-center">
                                    <div class="my-4">
                                        <i class="fa fa-search fa-5x text-muted mb-3"></i>
                                        <h4>Payment Not Found</h4>
                                        <p class="text-muted">
                                            The payment you're looking for could not be found or may have been removed.
                                        </p>
                                    </div>

                                    <div class="alert alert-warning">
                                        <strong>Possible reasons:</strong>
                                        <ul class="list-unstyled mt-2 mb-0">
                                            <li>• Invalid verification token</li>
                                            <li>• Payment has been deleted</li>
                                            <li>• Verification link has expired</li>
                                        </ul>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </t>
        </template>

        <!-- Payment Verification Error Template -->
        <template id="payment_verification_error" name="Payment Verification Error">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True"/>

                <t t-call="portal.portal_searchbar">
                    <t t-set="title">Verification Error</t>
                </t>

                <div class="container mt-4">
                    <div class="row justify-content-center">
                        <div class="col-lg-6">
                            
                            <div class="card shadow-sm">
                                <div class="card-header text-center" style="background-color: #dc3545; color: white;">
                                    <h2 class="mb-0">
                                        <i class="fa fa-exclamation-circle mr-2"></i>
                                        Verification Error
                                    </h2>
                                </div>

                                <div class="card-body text-center">
                                    <div class="my-4">
                                        <i class="fa fa-times-circle fa-5x text-danger mb-3"></i>
                                        <h4>Verification Error</h4>
                                        <p class="text-muted">
                                            <span t-esc="error_message or 'An error occurred while verifying the payment.'"/>
                                        </p>
                                    </div>

                                    <div class="alert alert-info">
                                        <strong>What can you do?</strong>
                                        <ul class="list-unstyled mt-2 mb-0">
                                            <li>• Check the verification link and try again</li>
                                            <li>• Contact support if the problem persists</li>
                                            <li>• Verify the QR code was scanned correctly</li>
                                        </ul>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </t>
        </template>

        <!-- Portal: My Payments -->
        <template id="portal_my_payments" name="My Payments">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True"/>

                <t t-call="portal.portal_searchbar">
                    <t t-set="title">My Payments</t>
                </t>

                <div class="container mt-4">
                    
                    <div class="row">
                        <div class="col-12">
                            <h3>My Payments</h3>
                            
                            <t t-if="not payments">
                                <div class="alert alert-info">
                                    <p class="mb-0">No payments found.</p>
                                </div>
                            </t>
                            
                            <t t-if="payments">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Reference</th>
                                                <th>Date</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr t-foreach="payments" t-as="payment">
                                                <td><span t-esc="payment.name"/></td>
                                                <td><span t-esc="payment.date"/></td>
                                                <td>
                                                    <span t-esc="payment.currency_id.symbol"/>
                                                    <span t-esc="'{:,.2f}'.format(payment.amount)"/>
                                                </td>
                                                <td>
                                                    <span class="badge badge-info" t-esc="payment.approval_state.title()"/>
                                                </td>
                                                <td>
                                                    <a t-attf-href="/my/payments/#{payment.id}" class="btn btn-sm btn-primary">View</a>
                                                    <a t-if="payment.verification_token" 
                                                       t-attf-href="/payment/verify/#{payment.verification_token}" 
                                                       class="btn btn-sm btn-success" target="_blank">Verify</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div t-if="pager" class="mt-3">
                                    <t t-call="portal.pager"/>
                                </div>
                            </t>
                            
                        </div>
                    </div>
                </div>

            </t>
        </template>

        <!-- Portal: Payment Detail Page -->
        <template id="portal_payment_page" name="Payment Detail">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True"/>

                <t t-call="portal.portal_searchbar">
                    <t t-set="title">Payment Details</t>
                </t>

                <div class="container mt-4">
                    <div class="row">
                        <div class="col-lg-8">
                            
                            <div class="card">
                                <div class="card-header">
                                    <h4>Payment <span t-esc="payment.name"/></h4>
                                </div>
                                <div class="card-body">
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td><strong>Date:</strong></td>
                                                    <td><span t-esc="payment.date"/></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Amount:</strong></td>
                                                    <td>
                                                        <span t-esc="payment.currency_id.symbol"/>
                                                        <span t-esc="'{:,.2f}'.format(payment.amount)"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Status:</strong></td>
                                                    <td>
                                                        <span class="badge badge-info" t-esc="payment.approval_state.title()"/>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="col-md-6">
                                            <div t-if="payment.verification_token" class="text-center">
                                                <img t-att-src="'data:image/png;base64,%s' % payment.qr_code_image.decode('ascii')" 
                                                     style="width: 120px; height: 120px;" 
                                                     alt="QR Code"/>
                                                <br/>
                                                <small>QR Code for Verification</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>

            </t>
        </template>

    </data>
</odoo>
