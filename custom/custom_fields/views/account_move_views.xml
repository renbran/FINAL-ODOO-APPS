<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_move_form_inherit_custom_fields" model="ir.ui.view">
        <field name="name">account.move.form.inherit.custom.fields</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <!-- Add Deal Information Tab -->
            <xpath expr="//notebook" position="inside">
                <page string="Deal Information" name="deal_info" invisible="move_type not in ('out_invoice', 'out_refund')">
                    <group>
                        <group string="Customer &amp; Deal Details" name="customer_deal_group">
                            <field name="buyer" 
                                   options="{'no_create': True, 'no_create_edit': True}"
                                   placeholder="Select buyer..."/>
                            <field name="deal_id" 
                                   placeholder="Enter deal reference..."/>
                            <field name="sale_order_type_id" string="Sales Type" placeholder="Select sales type..." options="{'no_create': False, 'no_create_edit': False}" readonly="0"/>
                            <field name="booking_date"/>
                        </group>
                        <group string="Project &amp; Unit Information" name="project_unit_group">
                            <field name="project" 
                                   options="{'no_create': True, 'no_create_edit': True}"
                                   placeholder="Select project..."/>
                            <field name="unit" 
                                   options="{'no_create': True, 'no_create_edit': True}"
                                   placeholder="Select unit..."/>
                        </group>
                    </group>
                    <group>
                        <group string="Financial Information" name="financial_group">
                            <field name="sale_value" 
                                   widget="monetary"
                                   options="{'currency_field': 'currency_id'}"/>
                            <field name="developer_commission" 
                                   widget="percentage"
                                   help="Commission percentage for the developer"/>
                        </group>
                        <group string="Additional Information" name="additional_group">
                            <!-- This group can be used for future deal-related fields -->
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- List View for Account Moves -->
    <record id="view_move_tree_inherit_custom_fields" model="ir.ui.view">
        <field name="name">account.move.tree.inherit.custom.fields</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="buyer" optional="hide"/>
                <field name="project" optional="hide"/>
                <field name="unit" optional="hide"/>
                <field name="deal_id" optional="hide"/>
                <field name="sale_order_type_id" optional="hide"/>
                <field name="booking_date" optional="hide"/>
            </xpath>
            <xpath expr="//field[@name='state']" position="before">
                <field name="sale_value" optional="hide"/>
                <field name="developer_commission" widget="percentage" optional="hide"/>
            </xpath>
        </field>
    </record>

    <!-- Search View for Account Moves -->
    <record id="view_account_invoice_filter_inherit_custom_fields" model="ir.ui.view">
        <field name="name">account.move.select.inherit.custom.fields</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="buyer"/>
                <field name="project"/>
                <field name="unit"/>
                <field name="deal_id"/>
                <field name="sale_order_type_id"/>
            </xpath>
            <xpath expr="//group[@expand='0']" position="inside">
                <filter string="Buyer" name="group_buyer" domain="[]" context="{'group_by': 'buyer'}"/>
                <filter string="Project" name="group_project" domain="[]" context="{'group_by': 'project'}"/>
                <filter string="Unit" name="group_unit" domain="[]" context="{'group_by': 'unit'}"/>
                <filter string="Booking Date" name="group_booking_date" domain="[]" context="{'group_by': 'booking_date'}"/>
                <filter string="Sales Type" name="group_sale_order_type_id" domain="[]" context="{'group_by': 'sale_order_type_id'}"/>
            </xpath>
        </field>
    </record>
</odoo>