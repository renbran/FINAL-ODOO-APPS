<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Advanced Payment Form View - Post Installation -->
        <record id="view_account_payment_form_advanced" model="ir.ui.view">
            <field name="name">account.payment.form.advanced</field>
            <field name="model">account.payment</field>
            <field name="inherit_id" ref="account_payment_final.view_account_payment_form_basic"/>
            <field name="arch" type="xml">
                
                <!-- Replace placeholder with actual approval state statusbar -->
                <xpath expr="//div[@class='payment-basic-info']" position="replace">
                    <field name="approval_state" widget="statusbar" 
                           statusbar_visible="draft,under_review,for_approval,for_authorization,approved,posted"
                           statusbar_colors='{"draft":"secondary","under_review":"info","for_approval":"warning","for_authorization":"warning","approved":"success","posted":"success"}'/>
                    
                    <!-- Workflow buttons -->
                    <button name="action_submit_for_review" 
                            string="Submit for Review" 
                            type="object" 
                            class="btn-primary"
                            attrs="{'invisible': [('approval_state', '!=', 'draft')]}"/>
                            
                    <button name="action_approve_payment" 
                            string="Approve" 
                            type="object" 
                            class="btn-success"
                            groups="account_payment_final.group_payment_voucher_approver"
                            attrs="{'invisible': [('approval_state', 'not in', ['under_review', 'for_approval'])]}"/>
                            
                    <button name="action_authorize_payment" 
                            string="Authorize" 
                            type="object" 
                            class="btn-warning"
                            groups="account_payment_final.group_payment_voucher_authorizer"
                            attrs="{'invisible': [('approval_state', '!=', 'for_authorization')]}"/>
                </xpath>
                
                <!-- Add voucher number after partner -->
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="voucher_number" readonly="1" attrs="{'invisible': [('voucher_number', '=', '/')]}" 
                           placeholder="Generated automatically..."/>
                </xpath>
                
                <!-- Add enhanced fields -->
                <xpath expr="//field[@name='ref']" position="after">
                    <field name="remarks" placeholder="Enter payment remarks or memo..."/>
                </xpath>
                
                <!-- Add QR code field -->
                <xpath expr="//field[@name='communication']" position="after">
                    <group string="QR Code Verification" attrs="{'invisible': [('qr_code', '=', False)]}">
                        <field name="qr_code" widget="image" class="oe_avatar" 
                               attrs="{'invisible': [('qr_code', '=', False)]}"/>
                        <field name="qr_in_report"/>
                    </group>
                </xpath>
                
            </field>
        </record>

        <!-- Advanced Tree View -->
        <record id="view_account_payment_tree_advanced" model="ir.ui.view">
            <field name="name">account.payment.tree.advanced</field>
            <field name="model">account.payment</field>
            <field name="inherit_id" ref="account_payment_final.view_account_payment_tree_enhanced"/>
            <field name="arch" type="xml">
                
                <!-- Add voucher number and approval state -->
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="voucher_number" optional="show"/>
                    <field name="approval_state" optional="show" widget="badge" 
                           decoration-info="approval_state == 'under_review'"
                           decoration-warning="approval_state in ['for_approval', 'for_authorization']"
                           decoration-success="approval_state in ['approved', 'posted']"/>
                </xpath>
                
            </field>
        </record>

    </data>
</odoo>
            <field name="arch" type="xml">
                
                <xpath expr="//field[@name='voucher_number']" position="after">
                    <field name="approval_state" widget="badge"/>
                </xpath>
                
            </field>
        </record>

    </data>
</odoo>
