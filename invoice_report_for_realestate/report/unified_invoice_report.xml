<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ====================================================================== -->
    <!-- UNIFIED SMART INVOICE REPORT - OSUS REAL ESTATE BROKERAGE LLC        -->
    <!-- Handles: Customer Invoices, Vendor Bills, Credit Notes, Debit Notes  -->
    <!-- ====================================================================== -->

    <!-- Unified Invoice/Bill Report Template -->
    <template id="report_unified_invoice_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-set="o" t-value="o.with_context(lang=lang)"/>
                <t t-set="format_uk_date" t-value="lambda d: d.strftime('%d/%m/%Y') if d else ''"/>
                <t t-set="format_number" t-value="lambda v: '{:,.2f}'.format(float(v)) if v else '0.00'"/>

                <!-- Determine document type -->
                <t t-set="is_invoice" t-value="o.move_type in ['out_invoice', 'out_refund']"/>
                <t t-set="is_bill" t-value="o.move_type in ['in_invoice', 'in_refund']"/>
                <t t-set="is_credit_note" t-value="o.move_type in ['out_refund', 'in_refund']"/>

                <!-- Document title based on type -->
                <t t-set="doc_title">
                    <t t-if="o.move_type == 'out_invoice'">TAX INVOICE</t>
                    <t t-elif="o.move_type == 'in_invoice'">VENDOR BILL</t>
                    <t t-elif="o.move_type == 'out_refund'">CREDIT NOTE</t>
                    <t t-elif="o.move_type == 'in_refund'">DEBIT NOTE</t>
                    <t t-else="">DOCUMENT</t>
                </t>

                <div class="page" style="font-family: 'Arial', 'Helvetica', sans-serif; font-size: 13px; line-height: 1.4; color: #000; background-color: #ffffff; margin: 0; padding: 0;">

                    <!-- Custom Header -->
                    <div style="background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%); padding: 20px 40px; border-bottom: 3px solid #800020; margin-bottom: 20px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="width: 30%; vertical-align: middle;">
                                    <img src="https://osusproperties.com/images/osus.png" alt="OSUS Properties" style="max-width: 120px; height: auto;"/>
                                </td>
                                <td style="width: 70%; vertical-align: top; text-align: right;">
                                    <div style="color: #333; font-size: 12px; line-height: 1.5;">
                                        <div style="font-weight: bold; font-size: 13px; margin-bottom: 3px;">OSUS REAL ESTATE BROKERAGE LLC</div>
                                        <div>Single Business Tower 29th Floor</div>
                                        <div>Business Bay Dubai</div>
                                        <div>United Arab Emirates</div>
                                        <div style="font-weight: bold; margin-top: 4px;">VAT: 100236589600003</div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div style="padding: 0 40px;">

                        <!-- QR Code and Partner Details Section -->
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <tr>
                                <td style="width: 20%; vertical-align: top;">
                                    <!-- QR Code Section (only for invoices/credit notes) -->
                                    <t t-if="is_invoice and o.qr_in_report and o.qr_image">
                                        <div style="text-align: left;">
                                            <div style="border: 2px solid #000; display: inline-block; padding: 5px;">
                                                <img t-att-src="image_data_uri(o.qr_image)" style="width: 120px; height: 120px; display: block;"/>
                                            </div>
                                            <div style="font-size: 10px; color: #800020; margin-top: 5px; font-weight: bold; text-align: center; max-width: 130px;">
                                                Scan to view <t t-esc="'credit note' if is_credit_note else 'invoice'"/>
                                            <br/>
or make payment
                                        </div>
                                    </div>
                                </t>
                            </td>
                            <td style="width: 80%; vertical-align: top; text-align: right;">
                                <div style="display: inline-block; text-align: right;">
                                    <h3 style="color: #800020; font-weight: bold; font-size: 15px; margin: 0 0 10px 0; text-decoration: underline;">
                                        <t t-if="is_invoice">CUSTOMER DETAILS</t>
                                        <t t-else="">VENDOR DETAILS</t>
                                    </h3>
                                    <div style="color: #000; font-size: 13px; line-height: 1.6; text-align: right;">
                                        <div style="font-weight: bold; margin-bottom: 3px;">
                                            <span t-field="o.partner_id.name"/>
                                        </div>
                                        <div style="margin-bottom: 2px;" t-if="o.partner_id.street" t-field="o.partner_id.street"/>
                                        <t t-if="o.partner_id.street2">
                                            <div style="margin-bottom: 2px;" t-field="o.partner_id.street2"/>
                                        </t>
                                        <div style="margin-bottom: 2px;" t-if="o.partner_id.city">
                                            <span t-field="o.partner_id.city"/>
                                        </div>
                                        <div style="margin-bottom: 2px;" t-if="o.partner_id.country_id" t-field="o.partner_id.country_id.name"/>
                                        <div style="font-weight: bold; margin-top: 3px;" t-if="o.partner_id.vat">
                                            <strong>VAT: <span t-field="o.partner_id.vat"/>
                                            </strong>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>

                    <!-- Document Header -->
                    <div style="text-align: center; margin: 25px 0;">
                        <h1 style="color: #800020; font-size: 28px; font-weight: bold; margin: 0; letter-spacing: 1px;">
                            <t t-esc="doc_title"/>
                            <span t-field="o.name" style="color: #800020;"/>
                        </h1>
                    </div>

                    <!-- Dates Row -->
                    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
                        <tr>
                            <td style="width: 33%; text-align: left; font-size: 13px;">
                                <strong style="color: #800020;">
                                    <t t-if="is_invoice">Invoice</t>
                                    <t t-else="">Bill</t> Date:</strong>
                                <span style="color: #000;" t-out="format_uk_date(o.invoice_date)"/>
                            </td>
                            <td style="width: 34%; text-align: center; font-size: 13px;">
                                <strong style="color: #800020;">Due Date:</strong>
                                <span style="color: #000;" t-out="format_uk_date(o.invoice_date_due or o.date)"/>
                            </td>
                            <td style="width: 33%; text-align: right; font-size: 13px;" t-if="o.booking_date">
                                <strong style="color: #800020;">Booking Date:</strong>
                                <span style="color: #000;" t-out="format_uk_date(o.booking_date)"/>
                            </td>
                        </tr>
                    </table>

                    <!-- Check if this is a real estate transaction (has buyer, project, unit) -->
                    <t t-set="is_realestate" t-value="hasattr(o, 'buyer_id') and o.buyer_id and hasattr(o, 'project_id') and o.project_id"/>

                    <!-- Real Estate Line Items Table -->
                    <t t-if="is_realestate">
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; border: 3px solid #800020;">
                            <thead>
                                <tr style="background-color: #800020; color: white;">
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: center;">BUYER</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: center;">PROJECT</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: center;">UNIT</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: center;">RATE</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: center;">UNIT PRICE</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: center;">VAT</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: center;">VAT AMOUNT</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: center;">AMOUNT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background-color: white;">
                                    <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: left; vertical-align: middle;">
                                        <span t-field="o.buyer_id.name"/>
                                    </td>
                                    <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: left; vertical-align: middle;">
                                        <span t-field="o.project_id.name"/>
                                    </td>
                                    <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: left; vertical-align: middle;">
                                        <span t-field="o.unit_id.name" t-if="o.unit_id"/>
                                    </td>
                                    <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: right; vertical-align: middle;">
                                        <t t-if="o.invoice_line_ids">
                                            <span t-esc="format_number(o.invoice_line_ids[0].quantity * 100)"/>
%
                                        </t>
                                        <t t-else="">0.00%</t>
                                    </td>
                                    <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: right; vertical-align: middle;">
                                        <span t-esc="format_number(o.sale_value if hasattr(o, 'sale_value') else o.amount_untaxed)"/>
 AED
                                    </td>
                                    <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: center; vertical-align: middle;">5%</td>
                                    <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: right; vertical-align: middle;">
                                        <span t-esc="format_number(o.amount_tax)"/>
 AED
                                    </td>
                                    <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: right; vertical-align: middle; font-weight: bold;">
                                        <span t-esc="format_number(o.amount_total)"/>
 AED
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </t>

                    <!-- Standard Line Items Table (for non-real estate) -->
                    <t t-if="not is_realestate">
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; border: 3px solid #800020;">
                            <thead>
                                <tr style="background-color: #800020; color: white;">
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: left;">DESCRIPTION</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: center;">QTY</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: right;">UNIT PRICE</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: right;">VAT</th>
                                    <th style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; font-weight: bold; text-align: right;">AMOUNT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="o.invoice_line_ids" t-as="line">
                                    <tr style="background-color: white;">
                                        <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: left; vertical-align: middle;">
                                            <span t-field="line.name"/>
                                        </td>
                                        <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: center; vertical-align: middle;">
                                            <span t-esc="format_number(line.quantity)"/>
                                        </td>
                                        <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: right; vertical-align: middle;">
                                            <span t-esc="format_number(line.price_unit)"/>
 AED
                                        </td>
                                        <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: right; vertical-align: middle;">
                                            <span t-esc="format_number(line.price_total - line.price_subtotal)"/>
 AED
                                        </td>
                                        <td style="padding: 12px 10px; border: 2px solid #800020; font-size: 13px; text-align: right; vertical-align: middle; font-weight: bold;">
                                            <span t-esc="format_number(line.price_total)"/>
 AED
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </t>

                    <!-- Totals Table -->
                    <table style="width: 45%; margin-left: auto; margin-bottom: 20px; border-collapse: collapse; border: 3px solid #800020;">
                        <tr style="background-color: #800020; color: white;">
                            <td style="padding: 10px 15px; border: 2px solid #ffffff; font-size: 13px; font-weight: bold; text-align: left;">UNTAXED AMOUNT</td>
                            <td style="padding: 10px 15px; border: 2px solid #ffffff; font-size: 13px; text-align: right; font-weight: bold;">
                                <span t-esc="format_number(o.amount_untaxed)"/>
 AED
                            </td>
                        </tr>
                        <tr style="background-color: #800020; color: white;">
                            <td style="padding: 10px 15px; border: 2px solid #ffffff; font-size: 13px; font-weight: bold; text-align: left;">VAT (5%)</td>
                            <td style="padding: 10px 15px; border: 2px solid #ffffff; font-size: 13px; text-align: right; font-weight: bold;">
                                <span t-esc="format_number(o.amount_tax)"/>
 AED
                            </td>
                        </tr>
                        <tr style="background-color: #000000; color: white;">
                            <td style="padding: 10px 15px; border: 2px solid #ffffff; font-size: 13px; font-weight: bold; text-align: left;">TOTAL <t t-if="is_credit_note">CREDIT</t>
                                <t t-else="">DUE</t> AMOUNT</td>
                            <td style="padding: 10px 15px; border: 2px solid #ffffff; font-size: 14px; text-align: right; font-weight: bold;">
                                <span t-esc="format_number(o.amount_total)"/>
 AED
                            </td>
                        </tr>
                    </table>

                    <!-- Amount in Words -->
                    <div style="margin-bottom: 20px; font-size: 13px;" t-if="o.amount_total_words">
                        <strong style="color: #800020;">Amount in Words (Total):</strong>
                        <span t-field="o.amount_total_words" style="font-style: italic; color: #000;"/>
                    </div>

                    <!-- Payment Instructions (for invoices only) -->
                    <t t-if="is_invoice">
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #800020; font-size: 16px; font-weight: bold; margin: 0 0 10px 0;">Payment Instructions</h3>
                            <p style="color: #000; font-size: 13px; margin-bottom: 10px;">Please pay to this Account Details in Cheque or Bank Transfer</p>
                            <table style="width: 100%; border-collapse: collapse; border: 3px solid #800020;">
                                <tr style="background-color: #f8f9fa;">
                                    <td style="width: 25%; color: #000; font-weight: bold; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">Bank Name</td>
                                    <td style="color: #000; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">ABU DHABI COMMERCIAL BANK (ADCB)</td>
                                </tr>
                                <tr>
                                    <td style="color: #000; font-weight: bold; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">Account Name</td>
                                    <td style="color: #000; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">OSUS REAL ESTATE BROKERAGE LLC</td>
                                </tr>
                                <tr style="background-color: #f8f9fa;">
                                    <td style="color: #000; font-weight: bold; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">Account No.</td>
                                    <td style="color: #000; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">14041417820001 - AED</td>
                                </tr>
                                <tr>
                                    <td style="color: #000; font-weight: bold; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">IBAN</td>
                                    <td style="color: #000; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">AE350030014041417820001</td>
                                </tr>
                                <tr style="background-color: #f8f9fa;">
                                    <td style="color: #000; font-weight: bold; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">Branch</td>
                                    <td style="color: #000; padding: 10px 15px; border: 2px solid #800020; font-size: 13px;">Business Bay</td>
                                </tr>
                            </table>
                            <p style="color: #000; margin-top: 8px; font-size: 11px; font-style: italic;">Please include your reference number when making the payment</p>
                        </div>
                    </t>
                </div>

                <!-- Custom Footer -->
                <div style="background-color: #f5f5f5; border-top: 3px solid #800020; padding: 15px 40px; margin-top: 30px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="width: 33%; vertical-align: middle; font-size: 12px;">
                                <div style="margin-bottom: 3px;">
                                    <strong style="color: #800020;">Phone:</strong>
                                    <span style="color: #000;">+971 4 336 4500</span>
                                </div>
                                <div>
                                    <strong style="color: #800020;">Email:</strong>
                                    <span style="color: #000;">info@osusproperties.com</span>
                                </div>
                            </td>
                            <td style="width: 34%; text-align: center; vertical-align: middle; font-size: 12px;">
                                <div>
                                    <a href="http://www.osusproperties.com" style="color: #800020; text-decoration: none; font-weight: bold;">www.osusproperties.com</a>
                                </div>
                            </td>
                            <td style="width: 33%; text-align: right; vertical-align: middle;">
                                <div style="color: #000; font-weight: bold; font-size: 11px;">
                                        This is a computer generated document. No signature or stamp required.
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

            </div>
        </t>
    </t>
</template>

<!-- Paper Format for Unified Report -->
<record id="paperformat_unified_invoice" model="report.paperformat">
    <field name="name">Unified Invoice Report A4 - OSUS</field>
    <field name="default" eval="False"/>
    <field name="format">A4</field>
    <field name="page_height">0</field>
    <field name="page_width">0</field>
    <field name="orientation">Portrait</field>
    <field name="margin_top">10</field>
    <field name="margin_bottom">10</field>
    <field name="margin_left">10</field>
    <field name="margin_right">10</field>
    <field name="header_line" eval="False"/>
    <field name="header_spacing">0</field>
    <field name="dpi">96</field>
</record>

<!-- Unified Smart Invoice Report Action - THIS IS THE ONLY ONE USERS WILL SEE -->
<record id="action_report_unified_invoice" model="ir.actions.report">
    <field name="name">Invoice/Bill</field>
    <field name="model">account.move</field>
    <field name="report_type">qweb-pdf</field>
    <field name="report_name">invoice_report_for_realestate.report_unified_invoice_document</field>
    <field name="report_file">invoice_report_for_realestate.report_unified_invoice_document</field>
    <field name="binding_model_id" ref="account.model_account_move"/>
    <field name="binding_type">report</field>
    <field name="paperformat_id" ref="paperformat_unified_invoice"/>
    <field name="print_report_name">
            object.move_type == 'in_invoice' and 'Bill - %s' % (object.name) or 
            object.move_type == 'in_refund' and 'Debit Note - %s' % (object.name) or 
            object.move_type == 'out_refund' and 'Credit Note - %s' % (object.name) or 
            'Invoice - %s' % (object.name)
    </field>
</record>

<!-- Override default Odoo invoice report -->
<record id="account.account_invoices" model="ir.actions.report">
    <field name="report_name">invoice_report_for_realestate.report_unified_invoice_document</field>
    <field name="report_file">invoice_report_for_realestate.report_unified_invoice_document</field>
    <field name="binding_type"/>
    <!-- Remove from print menu -->
</record>

<!-- Override default Odoo invoice without payment report -->
<record id="account.account_invoices_without_payment" model="ir.actions.report">
    <field name="binding_type"/>
    <!-- Remove from print menu -->
</record>
</odoo>
