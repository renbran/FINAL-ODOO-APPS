<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Main Property Form View -->
    <record id="view_property_form" model="ir.ui.view">
        <field name="name">property.property.form</field>
        <field name="model">property.property</field>
        <field name="arch" type="xml">
            <form string="Property" class="property-form">
                <!-- =========================== -->
                <!-- Header: status & actions -->
                <!-- =========================== -->
                <header>
                    <field name="state" widget="statusbar" 
                           statusbar_visible="available,reserved,booked,sold"
                           statusbar_colors='{"available":"green","reserved":"blue","booked":"orange","sold":"red"}'/>

                    <button name="action_generate_payment_schedule"
                            string="Generate Payment Schedule"
                            type="object"
                            class="oe_highlight"
                            invisible="offer_date == False"
                            groups="property_management.group_property_manager"/>

                    <button name="action_create_sale"
                            string="Create Sale"
                            type="object"
                            class="btn-secondary"
                            invisible="state != 'available'"
                            groups="property_management.group_property_sales"/>

                    <button name="action_view_sales"
                            string="View Sales"
                            type="object"
                            class="btn-secondary"
                            invisible="sale_count == 0"/>

                    <button name="action_print_offer"
                            string="Print Offer"
                            type="object"
                            class="btn-primary"
                            icon="fa-print"
                            invisible="offer_date == False"/>
                </header>

                <!-- =========================== -->
                <!-- Sheet Content -->
                <!-- =========================== -->
                <sheet>
                    <!-- Title Section -->
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Property Name" class="oe_inline"/>
                        </h1>
                        <div class="oe_kanban_global_click" invisible="payment_progress == 0">
                            <field name="payment_progress" 
                                   widget="progressbar" 
                                   options="{'title': 'Payment Progress', 'editable': false}"/>
                        </div>
                    </div>

                    <!-- Key Information Group -->
                    <group>
                        <group string="Basic Information">
                            <field name="property_reference"/>
                            <field name="project_name"/>
                            <field name="tower"/>
                            <field name="level"/>
                            <field name="unit_no"/>
                        </group>
                        <group string="Pricing">
                            <field name="total_sqft"/>
                            <field name="price_per_sqft"/>
                            <field name="property_price"/>
                            <field name="currency_id" options="{'no_create': True}"/>
                            <field name="sale_rent"/>
                        </group>
                    </group>

                    <!-- Notebook Tabs -->
                    <notebook>
                        <!-- Images &amp; Description Tab -->
                        <page string="Media" name="media_tab">
                            <group>
                                <group string="Images" col="2">
                                    <field name="property_image" widget="image" 
                                           options="{'preview_image': 'image_medium', 'zoom': true}"/>
                                    <field name="floor_plan" widget="image" 
                                           options="{'preview_image': 'image_medium', 'zoom': true}"/>
                                </group>
                                <group string="Description">
                                    <field name="description" nolabel="1"/>
                                </group>
                            </group>
                        </page>

                        <!-- Financial Details Tab -->
                        <page string="Financials" name="financial_tab">
                            <group>
                                <group string="Offer Details">
                                    <field name="offer_date"/>
                                    <field name="booking_amount" readonly="1"/>
                                    <field name="dld_fee" readonly="1"/>
                                    <field name="admin_fee"/>
                                    <field name="total_with_fees" readonly="1"/>
                                </group>
                                <group string="Unit Details">
                                    <field name="unit_view"/>
                                    <field name="status" readonly="1"/>
                                </group>
                            </group>
                        </page>

                        <!-- Payment Schedule Tab -->
                        <page string="Payments" name="payments_tab" invisible="not payment_schedule_ids">
                            <field name="payment_schedule_ids" 
                                   mode="tree,kanban" 
                                   nolabel="1"
                                   context="{'default_currency_id': currency_id}">
                                <tree editable="bottom" decoration-info="due_date &gt; current_date" 
                                      decoration-danger="due_date &lt; current_date and state != 'paid'">
                                    <field name="installment_no" widget="handle"/>
                                    <field name="due_date"/>
                                    <field name="percentage"/>
                                    <field name="amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                    <field name="state" widget="statusbar"/>
                                    <field name="currency_id" invisible="1"/>
                                </tree>
                                <kanban>
                                    <field name="installment_no"/>
                                    <field name="due_date"/>
                                    <field name="amount"/>
                                    <field name="state"/>
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div class="oe_kanban_content">
                                                <div>
                                                    <strong>Installment: <field name="installment_no"/></strong>
                                                </div>
                                                <div>
                                                    Due: <field name="due_date"/>
                                                </div>
                                                <div>
                                                    Amount: <field name="amount"/>
                                                </div>
                                                <div>
                                                    Status: <field name="state"/>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                            </field>
                        </page>

                        <!-- Sales Tab -->
                        <page string="Sales" name="sales_tab">
                            <field name="property_sale_ids" 
                                   mode="tree,form" 
                                   nolabel="1"
                                   context="{'default_property_id': id}">
                                <tree>
                                    <field name="sale_date"/>
                                    <field name="customer_id"/>
                                    <field name="total_amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>

                <!-- Chatter -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="many2many_tags" options="{'no_create': True}"/>
                    <field name="activity_ids" widget="kanban_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Payment Schedule Tree View -->
    <record id="view_property_payment_schedule_tree" model="ir.ui.view">
        <field name="name">property.payment.schedule.tree</field>
        <field name="model">property.payment.schedule</field>
        <field name="arch" type="xml">
            <tree string="Payment Schedule" decoration-info="due_date &gt; current_date" 
                  decoration-danger="due_date &lt; current_date and state != 'paid'">
                <field name="installment_no" widget="handle"/>
                <field name="due_date"/>
                <field name="percentage"/>
                <field name="amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                <field name="state" widget="statusbar"/>
                <field name="currency_id"/>
            </tree>
        </field>
    </record>

    <!-- Payment Schedule Form View -->
    <record id="view_property_payment_schedule_form" model="ir.ui.view">
        <field name="name">property.payment.schedule.form</field>
        <field name="model">property.payment.schedule</field>
        <field name="arch" type="xml">
            <form string="Payment Schedule">
                <sheet>
                    <group>
                        <group>
                            <field name="installment_no"/>
                            <field name="due_date"/>
                            <field name="percentage"/>
                        </group>
                        <group>
                            <field name="amount"/>
                            <field name="currency_id"/>
                            <field name="state"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
</odoo>