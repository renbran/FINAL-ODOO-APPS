<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="oe_sale_dashboard_17.SalesDashboard">
        <div class="sales_dashboard_container">
            <!-- Loading Indicator -->
            <div t-if="state.loading" class="loading_indicator">
                <i class="fa fa-spinner fa-spin fa-3x"></i>
                <p>Loading dashboard data...</p>
            </div>

            <!-- Dashboard Content -->
            <div t-if="!state.loading" class="dashboard_content">
                <!-- Header Section -->
                <div class="dashboard_header">
                    <div class="row">
                        <div class="col-md-8">
                            <h2>Sales Dashboard</h2>
                            <p>Real-time sales analytics and performance metrics</p>
                        </div>
                        <div class="col-md-4">
                            <div class="dashboard_filters">
                                <div class="form-group">
                                    <label>Date Range:</label>
                                    <div class="input-group">
                                        <input type="date" id="start_date" class="form-control" 
                                               t-att-value="state.dateRange.start"/>
                                        <input type="date" id="end_date" class="form-control" 
                                               t-att-value="state.dateRange.end"/>
                                        <button class="btn btn-primary" id="refresh_dashboard">
                                            <i class="fa fa-refresh"></i> Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KPI Cards Section -->
                <div class="kpi_section mb-4">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="kpi_card">
                                <div class="kpi_icon">
                                    <i class="fa fa-file-text-o"></i>
                                </div>
                                <div class="kpi_content">
                                    <h3 id="total_quotations">
                                        <t t-esc="state.data.performance.total_quotations or 0"/>
                                    </h3>
                                    <p>Total Quotations</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="kpi_card">
                                <div class="kpi_icon">
                                    <i class="fa fa-shopping-cart"></i>
                                </div>
                                <div class="kpi_content">
                                    <h3 id="total_orders">
                                        <t t-esc="state.data.performance.total_orders or 0"/>
                                    </h3>
                                    <p>Sales Orders</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="kpi_card">
                                <div class="kpi_icon">
                                    <i class="fa fa-check-circle"></i>
                                </div>
                                <div class="kpi_content">
                                    <h3 id="total_invoiced">
                                        <t t-esc="state.data.performance.total_invoiced or 0"/>
                                    </h3>
                                    <p>Invoiced Sales</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="kpi_card">
                                <div class="kpi_icon">
                                    <i class="fa fa-money"></i>
                                </div>
                                <div class="kpi_content">
                                    <h3 id="total_amount">
                                        <t t-esc="state.data.performance.total_amount or '0'"/>
                                    </h3>
                                    <p>Total Revenue</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts_section">
                    <div class="row">
                        <!-- Monthly Trend Chart -->
                        <div class="col-md-8">
                            <div class="chart_container">
                                <div class="chart_header">
                                    <h4>Monthly Sales Trend</h4>
                                    <p>Track sales performance over time</p>
                                </div>
                                <div class="chart_body">
                                    <canvas id="monthly_trend_chart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sales by State Pie Chart -->
                        <div class="col-md-4">
                            <div class="chart_container">
                                <div class="chart_header">
                                    <h4>Sales by State</h4>
                                    <p>Distribution of sales stages</p>
                                </div>
                                <div class="chart_body">
                                    <canvas id="sales_state_chart" width="300" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <!-- Top Customers Chart -->
                        <div class="col-md-6">
                            <div class="chart_container">
                                <div class="chart_header">
                                    <h4>Top Customers</h4>
                                    <p>Best performing customers by revenue</p>
                                </div>
                                <div class="chart_body">
                                    <canvas id="top_customers_chart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sales Team Performance -->
                        <div class="col-md-6">
                            <div class="chart_container">
                                <div class="chart_header">
                                    <h4>Sales Team Performance</h4>
                                    <p>Individual salesperson performance</p>
                                </div>
                                <div class="chart_body">
                                    <canvas id="sales_team_chart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Metrics Section -->
                <div class="metrics_section mt-4">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="metrics_container">
                                <h4>Performance Metrics</h4>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="metric_item">
                                            <div class="metric_label">Conversion Rate</div>
                                            <div class="metric_value">
                                                <t t-esc="state.data.performance.conversion_rate or 0"/>%
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric_item">
                                            <div class="metric_label">Invoiced Amount</div>
                                            <div class="metric_value">
                                                <t t-esc="state.data.performance.invoiced_amount or '0'"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric_item">
                                            <div class="metric_label">Avg. Order Value</div>
                                            <div class="metric_value">
                                                <t t-if="state.data.performance.total_orders > 0">
                                                    <t t-esc="Math.round((state.data.performance.total_amount || 0) / state.data.performance.total_orders)"/>
                                                </t>
                                                <t t-else="">0</t>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>
