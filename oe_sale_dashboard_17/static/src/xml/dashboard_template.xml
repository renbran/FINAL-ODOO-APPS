<?xml version="1.0" encoding="UTF-8"?>
<!-- This module is under copyright of 'OdooElevate' -->
<templates id="template" xml:space="preserve">
    <t t-name="oe_sale_dashboard_17.yearly_sales_dashboard_template" owl="1">
        <div t-ref="dashboard_root" class="o_oe_sale_dashboard_17_container" style="overflow-y: auto; overflow-x: hidden; height: 100vh; padding-bottom: 2rem;">
            
            <!-- Executive Dashboard Header -->
            <div class="o_oe_sale_dashboard_17_container__header">
                <h1>Executive Sales Dashboard</h1>
                <p class="subtitle">Real-time business intelligence and sales performance analytics</p>
            </div>

            <!-- Date Range Controls -->
            <div class="o_oe_sale_dashboard_17_container__controls">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex flex-col md:flex-row items-center gap-4">
                        <div class="date-group">
                            <label for="startDate">Start Date</label>
                            <input type="date" id="startDate" t-att-value="state.startDate" t-on-change="onStartDateChange"/>
                        </div>
                        <div class="date-group">
                            <label for="endDate">End Date</label>
                            <input type="date" id="endDate" t-att-value="state.endDate" t-on-change="onEndDateChange"/>
                        </div>
                    </div>
                    <div t-if="state.isLoading" class="loading-indicator">
                        <div class="spinner"></div>
                        <span>Updating analytics...</span>
                    </div>
                </div>
            </div>

            <!-- Executive KPI Cards -->
            <div id="kpi-section" class="o_oe_sale_dashboard_17_container__kpi-grid" t-ref="kpiContainer">
                <!-- KPI cards will be dynamically generated here -->
            </div>

            <!-- Interactive Charts Section -->
            <div id="charts-section" class="o_oe_sale_dashboard_17_container__charts">
                <!-- Revenue Distribution Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Revenue Distribution</h3>
                        <div class="chart-controls">
                            <button class="active" data-chart="revenue">Revenue</button>
                            <button data-chart="volume">Volume</button>
                        </div>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- Sales Type Count Distribution -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Sales Type by Count</h3>
                        <p class="chart-subtitle">Distribution of sales count by type (excluding cancelled)</p>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="salesTypeCountChart"></canvas>
                    </div>
                </div>

                <!-- Sales Type Total Distribution -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Sales Type by Amount</h3>
                        <p class="chart-subtitle">Distribution of sales amount by type (excluding cancelled)</p>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="salesTypeTotalChart"></canvas>
                    </div>
                </div>

                <!-- Sales Funnel Visualization -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Sales Pipeline</h3>
                        <div class="chart-controls">
                            <button class="active" data-funnel="amount">Amount</button>
                            <button data-funnel="count">Count</button>
                        </div>
                    </div>
                    <div class="o_oe_sale_dashboard_17_container__funnel" t-ref="funnelContainer">
                        <!-- Funnel stages will be generated here -->
                    </div>
                </div>

                <!-- Deal Fluctuation Chart -->
                <div class="chart-container" style="grid-column: 1 / -1;">
                    <div class="chart-header">
                        <h3>Deal Fluctuations</h3>
                        <p class="chart-subtitle">Monthly trend analysis of deals progression</p>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="dealFluctuationChart"></canvas>
                    </div>
                </div>

                <!-- Performance Trend Chart -->
                <div class="chart-container" style="grid-column: 1 / -1;">
                    <div class="chart-header">
                        <h3>Sales Performance Trend</h3>
                        <div class="chart-controls">
                            <button class="active" data-period="month">Monthly</button>
                            <button data-period="quarter">Quarterly</button>
                            <button data-period="year">Yearly</button>
                        </div>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Enhanced Data Tables -->
            <!-- Quotations Section -->
            <div id="quotations-section" class="o_oe_sale_dashboard_17_container__table-section">
                <div class="table-header">
                    <h2>
                        Quotations
                        <span class="status-badge status-badge--quotations">Pipeline</span>
                    </h2>
                    <div class="table-summary">
                        <div class="summary-item">
                            <strong t-esc="state.quotationsData.find(item => item.sales_type_name === 'Total')?.count || 0"/> Active Quotes
                        </div>
                        <div class="summary-item">
                            Total Value: <strong t-esc="this.formatNumber(state.quotationsData.find(item => item.sales_type_name === 'Total')?.amount || 0)"/>
                        </div>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Sales Type</th>
                                <th>Count</th>
                                <th>Total Amount</th>
                                <th>Sale Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="state.quotationsData" t-as="sales_type_data" t-key="sales_type_data.sales_type_name">
                                <tr t-att-class="{'total-row': sales_type_data.sales_type_name === 'Total'}">
                                    <td t-esc="sales_type_data.sales_type_name"/>
                                    <td class="count-cell" t-esc="sales_type_data.count || 0"/>
                                    <td class="amount-cell" t-esc="this.formatNumber(sales_type_data.amount)"/>
                                    <td class="amount-cell" t-esc="this.formatNumber(sales_type_data.sale_value)"/>
                                </tr>
                            </t>
                            <t t-if="state.quotationsData.length === 0 &amp;&amp; !state.isLoading">
                                <tr>
                                    <td colspan="4" class="no-data">
                                        <div class="no-data-icon">ðŸ“Š</div>
                                        <div>No quotations data available for the selected period.</div>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sales Orders Section -->
            <div id="orders-section" class="o_oe_sale_dashboard_17_container__table-section">
                <div class="table-header">
                    <h2>
                        Sales Orders
                        <span class="status-badge status-badge--orders">Active</span>
                    </h2>
                    <div class="table-summary">
                        <div class="summary-item">
                            <strong t-esc="state.salesOrdersData.find(item => item.sales_type_name === 'Total')?.count || 0"/> Pending Orders
                        </div>
                        <div class="summary-item">
                            Total Value: <strong t-esc="this.formatNumber(state.salesOrdersData.find(item => item.sales_type_name === 'Total')?.amount || 0)"/>
                        </div>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Sales Type</th>
                                <th>Count</th>
                                <th>Total Amount</th>
                                <th>Sale Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="state.salesOrdersData" t-as="sales_type_data" t-key="sales_type_data.sales_type_name">
                                <tr t-att-class="{'total-row': sales_type_data.sales_type_name === 'Total'}">
                                    <td t-esc="sales_type_data.sales_type_name"/>
                                    <td class="count-cell" t-esc="sales_type_data.count || 0"/>
                                    <td class="amount-cell" t-esc="this.formatNumber(sales_type_data.amount)"/>
                                    <td class="amount-cell" t-esc="this.formatNumber(sales_type_data.sale_value)"/>
                                </tr>
                            </t>
                            <t t-if="state.salesOrdersData.length === 0 &amp;&amp; !state.isLoading">
                                <tr>
                                    <td colspan="4" class="no-data">
                                        <div class="no-data-icon">ðŸ“‹</div>
                                        <div>No sales orders data available for the selected period.</div>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Invoiced Sales Section -->
            <div id="invoiced-section" class="o_oe_sale_dashboard_17_container__table-section">
                <div class="table-header">
                    <h2>
                        Invoiced Sales
                        <span class="status-badge status-badge--invoiced">Completed</span>
                    </h2>
                    <div class="table-summary">
                        <div class="summary-item">
                            <strong t-esc="state.invoicedSalesData.find(item => item.sales_type_name === 'Total')?.count || 0"/> Completed Sales
                        </div>
                        <div class="summary-item">
                            Revenue Realized: <strong t-esc="this.formatNumber(state.invoicedSalesData.find(item => item.sales_type_name === 'Total')?.invoiced_amount || 0)"/>
                        </div>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Sales Type</th>
                                <th>Count</th>
                                <th>Total Amount</th>
                                <th>Sale Value</th>
                                <th>Revenue Realized</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="state.invoicedSalesData" t-as="sales_type_data" t-key="sales_type_data.sales_type_name">
                                <tr t-att-class="{'total-row': sales_type_data.sales_type_name === 'Total'}">
                                    <td t-esc="sales_type_data.sales_type_name"/>
                                    <td class="count-cell" t-esc="sales_type_data.count || 0"/>
                                    <td class="amount-cell" t-esc="this.formatNumber(sales_type_data.amount)"/>
                                    <td class="amount-cell" t-esc="this.formatNumber(sales_type_data.sale_value)"/>
                                    <td class="amount-cell" style="font-weight: 700; color: var(--o-oe-success);" t-esc="this.formatNumber(sales_type_data.invoiced_amount)"/>
                                </tr>
                            </t>
                            <t t-if="state.invoicedSalesData.length === 0 &amp;&amp; !state.isLoading">
                                <tr>
                                    <td colspan="5" class="no-data">
                                        <div class="no-data-icon">ðŸ’°</div>
                                        <div>No invoiced sales data available for the selected period.</div>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Performance Summary -->
            <div class="o_oe_sale_dashboard_17_container__performance" t-ref="performanceContainer">
                <!-- Performance cards will be generated here -->
            </div>

        </div>
    </t>
</templates>
